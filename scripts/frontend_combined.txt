æ–‡ä»¶æ‹¼æ¥ç»“æœ
æºæ–‡ä»¶å¤¹: /home/wowyuarm/projects/Xi/frontend
ç”Ÿæˆæ—¶é—´: /home/wowyuarm/projects/Xi
================================================================================

ğŸ“ æ–‡ä»¶ç»“æ„:
----------------------------------------
â””â”€â”€ ğŸ“ public
â””â”€â”€ ğŸ“ scripts
    â”œâ”€â”€ ğŸ“„ toggle-mock.cjs
â””â”€â”€ ğŸ“ src
    â”œâ”€â”€ ğŸ“ app
    â”‚   â”œâ”€â”€ ğŸŸª App.tsx
    â”‚   â”œâ”€â”€ ğŸ¨ globals.css
    â”‚   â”œâ”€â”€ ğŸŸª main.tsx
    â”œâ”€â”€ ğŸ“ components
    â”‚   â”œâ”€â”€ ğŸ“ common
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª Container.tsx
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª EmptyState.tsx
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª ErrorBoundary.tsx
    â”‚   â”‚   â”œâ”€â”€ ğŸŸ¦ index.ts
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª LoadingState.tsx
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª ScrollArea.tsx
    â”‚   â”œâ”€â”€ ğŸ“ ui
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª AutoResizeTextarea.tsx
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª Button.tsx
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª ConnectionStatus.tsx
    â”‚   â”‚   â”œâ”€â”€ ğŸŸ¦ index.ts
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª MarkdownRenderer.tsx
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª RoleSymbol.tsx
    â”‚   â”‚   â”œâ”€â”€ ğŸŸª Timestamp.tsx
    â”‚   â”œâ”€â”€ ğŸŸ¦ index.ts
    â”œâ”€â”€ ğŸ“ features
    â”‚   â”œâ”€â”€ ğŸ“ chat
    â”‚   â”‚   â””â”€â”€ ğŸ“ components
    â”‚   â”‚       â”œâ”€â”€ ğŸŸª ChatInput.tsx
    â”‚   â”‚       â”œâ”€â”€ ğŸŸª ChatMessage.tsx
    â”‚   â”‚       â”œâ”€â”€ ğŸŸª ChatView.tsx
    â”‚   â”‚       â”œâ”€â”€ ğŸŸª ScrollToBottomButton.tsx
    â”‚   â”‚   â””â”€â”€ ğŸ“ data
    â”‚   â”‚       â”œâ”€â”€ ğŸ“ MOCK_DATA.md
    â”‚   â”‚       â”œâ”€â”€ ğŸŸ¦ mockData.ts
    â”‚   â”‚       â”œâ”€â”€ ğŸŸ¦ mockResponses.ts
    â”‚   â”‚       â”œâ”€â”€ ğŸ“ TEST_GUIDE.md
    â”‚   â”‚   â””â”€â”€ ğŸ“ hooks
    â”‚   â”‚       â”œâ”€â”€ ğŸŸ¦ useChat.ts
    â”‚   â”‚       â”œâ”€â”€ ğŸŸ¦ useTypewriter.ts
    â”‚   â”‚   â””â”€â”€ ğŸ“ store
    â”‚   â”‚       â”œâ”€â”€ ğŸŸ¦ chatStore.ts
    â”‚   â”‚   â””â”€â”€ ğŸŸª ChatContainer.tsx
    â”‚   â”‚   â””â”€â”€ ğŸŸª index.tsx
    â”‚   â”‚   â””â”€â”€ ğŸŸ¦ types.ts
    â”œâ”€â”€ ğŸ“ hooks
    â”‚   â”œâ”€â”€ ğŸŸ¦ useAutoScroll.ts
    â”œâ”€â”€ ğŸ“ lib
    â”‚   â”œâ”€â”€ ğŸŸ¦ utils.ts
    â”œâ”€â”€ ğŸ“ services
    â”‚   â”œâ”€â”€ ğŸ“ websocket
    â”‚   â”‚   â””â”€â”€ ğŸŸ¦ manager.ts
    â”‚   â”‚   â””â”€â”€ ğŸŸ¦ protocol.ts
    â”œâ”€â”€ ğŸ“ FRONTEND_PHILOSOPHY.md
    â”œâ”€â”€ ğŸŸ¦ vite-env.d.ts
â””â”€â”€ ğŸ“„ .env
â””â”€â”€ ğŸ“„ .env.example
â””â”€â”€ ğŸ“¦ components.json
â””â”€â”€ ğŸŸ¨ eslint.config.js
â””â”€â”€ ğŸŒ index.html
â””â”€â”€ ğŸ“¦ package.json
â””â”€â”€ ğŸ“„ pnpm-lock.yaml
â””â”€â”€ ğŸŸ¨ postcss.config.js
â””â”€â”€ ğŸ“ README.md
â””â”€â”€ ğŸŸ¨ tailwind.config.js
â””â”€â”€ ğŸ“¦ tsconfig.app.json
â””â”€â”€ ğŸ“¦ tsconfig.json
â””â”€â”€ ğŸ“¦ tsconfig.node.json
â””â”€â”€ ğŸŸ¦ vite.config.ts
----------------------------------------


------------------------------------------------------------
æ–‡ä»¶å¤¹: public
------------------------------------------------------------


------------------------------------------------------------
æ–‡ä»¶å¤¹: scripts
------------------------------------------------------------


------------------------------------------------------------
æ–‡ä»¶å¤¹: src
------------------------------------------------------------


  ------------------------------------------------------------
  æ–‡ä»¶å¤¹: app
  ------------------------------------------------------------


    ================================================================================
    æ–‡ä»¶å: App.tsx
    è·¯å¾„: App.tsx
    ================================================================================

    import { ChatView } from "@/features/chat";

function App() {
  return <ChatView />;
}

export default App;

    ================================================================================
    æ–‡ä»¶å: globals.css
    è·¯å¾„: globals.css
    ================================================================================

    @tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root, .dark {
    /* ç°åº¦ä¸­åº¸è°ƒè‰²æ¿ (Grayscale Moderation Palette) */
    --background: 0 0% 10%;         /* #1a1a1a - æ ¸å¿ƒèƒŒæ™¯ */
    --foreground: 0 0% 75%;         /* #bfbfbf - ä¸»æ–‡æœ¬ */

    --card: 0 0% 12%;               /* #1f1f1f - å†…å®¹åŒº/è¾“å…¥æ¡†èƒŒæ™¯ */
    --card-foreground: 0 0% 85%;    /* #d9d9d9 - å¡ç‰‡å†…ä¸»è¦æ–‡æœ¬ */

    --popover: 0 0% 8%;
    --popover-foreground: 0 0% 85%;

    --primary: 0 0% 90%;            /* #e6e6e6 - ä¸»è¦äº¤äº’å…ƒç´  */
    --primary-foreground: 0 0% 10%;

    --secondary: 0 0% 14%;          /* #242424 - ç”¨äºæ¬¡çº§èƒŒæ™¯/æ‚¬åœ */
    --secondary-foreground: 0 0% 60%; /* #999999 - æ¬¡è¦/é™éŸ³æ–‡æœ¬ */

    --muted: 0 0% 14%;
    --muted-foreground: 0 0% 60%;

    --accent: 0 0% 14%;
    --accent-foreground: 0 0% 90%;

    --border: 0 0% 18%;             /* #2e2e2e - è¾¹æ¡† */
    --input: 0 0% 18%;
    --ring: 0 0% 90%;               /* ç„¦ç‚¹ç¯ */

    --radius: 0.75rem;
  }
}

@layer base {
  * { @apply border-border; }
  body {
    @apply bg-background text-foreground antialiased;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}

@layer utilities {
  /* ç²¾ç»†åŒ–ã€ç»Ÿä¸€çš„Proseæ ·å¼ - éµå¾ªç°åº¦ä¸­åº¸è®¾è®¡å“²å­¦ */
  .prose {
    @apply text-foreground max-w-none;
    line-height: 1.75;
  }

  /* åŸºç¡€é—´è· - æ’é™¤åˆ—è¡¨ï¼Œè®©è‡ªå®šä¹‰ç»„ä»¶æ§åˆ¶ */
  .prose p, .prose blockquote, .prose pre {
    @apply my-4;
  }
  .prose :first-child { @apply mt-0; }
  .prose :last-child { @apply mb-0; }

  /* è¡Œå†…ä»£ç æ ·å¼ - ä¸ç»„ä»¶ä¿æŒä¸€è‡´ */
  .prose code:not(pre code) {
    @apply inline px-1.5 py-0.5 text-base font-mono bg-muted/40 text-foreground rounded-sm break-words;
  }

  /* åˆ—è¡¨æ ·å¼ - ä½¿ç”¨CSSå¤„ç†åµŒå¥— */
  .prose ul, .prose ol {
    @apply list-none pl-0 my-0;
  }

  /* åµŒå¥—åˆ—è¡¨ç‰¹æ®Šæ ·å¼ */
  .prose ul ul, .prose ol ol, .prose ul ol, .prose ol ul {
    @apply mt-1.5 mb-0 pl-4;
  }

  /* é“¾æ¥æ ·å¼ */
  .prose a {
    @apply text-foreground underline decoration-secondary-foreground/30 decoration-1 underline-offset-2;
    @apply transition-all duration-300 ease-in-out;
  }
  .prose a:hover {
    @apply text-primary decoration-secondary-foreground/50;
  }

  /* å¼ºè°ƒæ–‡æœ¬ */
  .prose strong {
    @apply font-semibold text-foreground;
  }

  .prose em {
    @apply italic text-foreground;
  }

  /* æ»šåŠ¨æ¡æ ·å¼ */
  ::-webkit-scrollbar {
    width: 8px;  /* ç«–å‘æ»šåŠ¨æ¡å®½åº¦ */
    height: 8px; /* æ¨ªå‘æ»šåŠ¨æ¡é«˜åº¦ */
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background: hsl(var(--border) / 0.6);
    border-radius: 9999px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--border));
  }
}



    ================================================================================
    æ–‡ä»¶å: main.tsx
    è·¯å¾„: main.tsx
    ================================================================================

    import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import './globals.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)

  ------------------------------------------------------------
  æ–‡ä»¶å¤¹: components
  ------------------------------------------------------------


    ------------------------------------------------------------
    æ–‡ä»¶å¤¹: common
    ------------------------------------------------------------


      ================================================================================
      æ–‡ä»¶å: Container.tsx
      è·¯å¾„: Container.tsx
      ================================================================================

      // src/components/common/Container.tsx
// é€šç”¨å®¹å™¨ç»„ä»¶ï¼Œæ”¯æŒä¸åŒå®½åº¦å’Œå±…ä¸­
import React, { type ComponentProps } from 'react';
import { cn } from '@/lib/utils';

interface ContainerProps extends ComponentProps<'div'> {
  size?: 'sm' | 'md' | 'lg' | 'xl';
  centered?: boolean;
  material?: boolean; // æ˜¯å¦åº”ç”¨æ ‡å‡†æè´¨
}

export const Container: React.FC<ContainerProps> = ({
  size = 'md',
  centered = true,
  material = false,
  className,
  children,
  ...props
}) => {
  const sizeClasses = {
    sm: 'max-w-lg',    // 512px
    md: 'max-w-2xl',   // 672px - æˆ‘ä»¬çš„æ ‡å‡†å®½åº¦
    lg: 'max-w-4xl',   // 896px
    xl: 'max-w-6xl'    // 1152px
  };

  return (
    <div
      className={cn(
        'w-full',
        sizeClasses[size],
        centered && 'mx-auto',
        material && [
          'bg-card/75 backdrop-blur-xl',
          'border border-border',
          'shadow-lg shadow-black/20',
          'rounded-2xl p-6'
        ],
        className
      )}
      {...props}
    >
      {children}
    </div>
  );
};


      ================================================================================
      æ–‡ä»¶å: EmptyState.tsx
      è·¯å¾„: EmptyState.tsx
      ================================================================================

      // src/components/common/EmptyState.tsx
// ç©ºçŠ¶æ€å±•ç¤ºï¼Œæ”¯æŒå›¾æ ‡ã€æè¿°å’Œæ“ä½œæŒ‰é’®
import React from 'react';
import { motion } from 'framer-motion';
import { cn } from '@/lib/utils';

interface EmptyStateProps {
  title?: string;
  description?: string;
  icon?: React.ReactNode;
  action?: React.ReactNode;
  className?: string;
}

export const EmptyState: React.FC<EmptyStateProps> = ({
  title = "æš‚æ— å†…å®¹",
  description,
  icon,
  action,
  className
}) => {
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4, ease: 'easeOut' }}
      className={cn(
        'flex flex-col items-center justify-center text-center py-12',
        className
      )}
    >
      {icon && (
        <div className="mb-4 text-muted-foreground">
          {icon}
        </div>
      )}
      
      <h3 className="text-base font-medium text-foreground mb-2">
        {title}
      </h3>

      {description && (
        <p className="text-sm text-secondary-foreground mb-6 max-w-sm leading-relaxed">
          {description}
        </p>
      )}
      
      {action && (
        <div>
          {action}
        </div>
      )}
    </motion.div>
  );
};


      ================================================================================
      æ–‡ä»¶å: ErrorBoundary.tsx
      è·¯å¾„: ErrorBoundary.tsx
      ================================================================================

      // src/components/common/ErrorBoundary.tsx 
// Reacté”™è¯¯è¾¹ç•Œï¼Œä¼˜é›…å¤„ç†ç»„ä»¶é”™è¯¯
import { Component, type ErrorInfo, type ReactNode } from 'react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends Component<Props, State> {
  public state: State = {
    hasError: false
  };

  public static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('ErrorBoundary caught an error:', error, errorInfo);
  }

  public render() {
    if (this.state.hasError) {
      return this.props.fallback || (
        <div className="flex flex-col items-center justify-center min-h-[200px] text-center p-6">
          <div className="w-12 h-12 rounded-full bg-secondary/50 flex items-center justify-center mb-4">
            <div className="text-secondary-foreground text-lg">âš </div>
          </div>
          <div className="text-base text-foreground mb-2">
            å‡ºç°äº†ä¸€äº›é—®é¢˜
          </div>
          <div className="text-sm text-secondary-foreground leading-relaxed max-w-md">
            {this.state.error?.message || 'è¯·åˆ·æ–°é¡µé¢é‡è¯•'}
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}


      ================================================================================
      æ–‡ä»¶å: index.ts
      è·¯å¾„: index.ts
      ================================================================================

      // src/components/common/index.ts
// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰é€šç”¨ç»„ä»¶

export { ErrorBoundary } from './ErrorBoundary';
export { LoadingState } from './LoadingState';
export { Container } from './Container';
export { EmptyState } from './EmptyState';
export { ScrollArea } from './ScrollArea';

// æœªæ¥å¯èƒ½æ·»åŠ çš„é€šç”¨ç»„ä»¶ï¼š
// export { Modal } from './Modal';
// export { Toast } from './Toast';
// export { Tooltip } from './Tooltip';
// export { Portal } from './Portal';
// export { KeyboardShortcuts } from './KeyboardShortcuts';


      ================================================================================
      æ–‡ä»¶å: LoadingState.tsx
      è·¯å¾„: LoadingState.tsx
      ================================================================================

      // src/components/common/LoadingState.tsx 
// ç»Ÿä¸€çš„åŠ è½½çŠ¶æ€ç»„ä»¶ï¼Œæ”¯æŒä¸åŒå°ºå¯¸
import React from 'react';
import { motion } from 'framer-motion';
import { cn } from '@/lib/utils';

interface LoadingStateProps {
  message?: string;
  size?: 'sm' | 'md' | 'lg';
  className?: string;
}

export const LoadingState: React.FC<LoadingStateProps> = ({ 
  message = "åŠ è½½ä¸­...",
  size = 'md',
  className 
}) => {
  const sizeClasses = {
    sm: 'w-4 h-4',
    md: 'w-6 h-6', 
    lg: 'w-8 h-8'
  };

  return (
    <div className={cn(
      'flex flex-col items-center justify-center gap-3',
      className
    )}>
      <motion.div
        className={cn(
          'border-2 border-border rounded-full relative',
          sizeClasses[size]
        )}
        animate={{ rotate: 360 }}
        transition={{
          duration: 1,
          repeat: Infinity,
          ease: 'linear'
        }}
      >
        <div className="absolute inset-0 border-2 border-transparent border-t-foreground rounded-full" />
      </motion.div>
      {message && (
        <div className="text-sm text-secondary-foreground">
          {message}
        </div>
      )}
    </div>
  );
};


      ================================================================================
      æ–‡ä»¶å: ScrollArea.tsx
      è·¯å¾„: ScrollArea.tsx
      ================================================================================

      // src/components/common/ScrollArea.tsx
// è‡ªå®šä¹‰æ»šåŠ¨åŒºåŸŸï¼Œæ”¯æŒä¸åŒæ–¹å‘å’Œæ»šåŠ¨æ¡æ ·å¼
import React, { type ComponentProps } from 'react';
import { cn } from '@/lib/utils';

interface ScrollAreaProps extends ComponentProps<'div'> {
  orientation?: 'vertical' | 'horizontal' | 'both';
  maxHeight?: string; // æ”¯æŒæœ€å¤§é«˜åº¦é™åˆ¶
}

export const ScrollArea: React.FC<ScrollAreaProps> = ({
  orientation = 'vertical',
  maxHeight,
  className,
  children,
  ...props
}) => {
  const overflowClasses = {
    vertical: 'overflow-y-auto overflow-x-hidden',
    horizontal: 'overflow-x-auto overflow-y-hidden',
    both: 'overflow-auto'
  } as const;

  return (
    <div
      className={cn(
        overflowClasses[orientation],
        className
      )}
      style={{
        maxHeight: maxHeight,
        ...props.style
      }}
      {...props}
    >
      {children}
    </div>
  );
};


    ------------------------------------------------------------
    æ–‡ä»¶å¤¹: ui
    ------------------------------------------------------------


      ================================================================================
      æ–‡ä»¶å: AutoResizeTextarea.tsx
      è·¯å¾„: AutoResizeTextarea.tsx
      ================================================================================

      // src/components/ui/AutoResizeTextarea.tsx
// è‡ªåŠ¨è°ƒæ•´é«˜åº¦çš„æ–‡æœ¬è¾“å…¥æ¡† - çº¯UIç»„ä»¶
import { useRef, useEffect, forwardRef, useImperativeHandle, type ComponentProps } from 'react';
import { cn } from '@/lib/utils';

interface AutoResizeTextareaProps extends Omit<ComponentProps<'textarea'>, 'rows'> {
  maxHeightMultiplier?: number; // æœ€å¤§é«˜åº¦å€æ•°ï¼Œé»˜è®¤ä¸º2
  minRows?: number; // æœ€å°è¡Œæ•°ï¼Œé»˜è®¤ä¸º3
  onReset?: () => void; // é‡ç½®æ—¶çš„å›è°ƒ
}

// æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•
export interface AutoResizeTextareaRef {
  resetHeight: () => void;
  focus: () => void;
}

export const AutoResizeTextarea = forwardRef<AutoResizeTextareaRef, AutoResizeTextareaProps>(
  ({ maxHeightMultiplier = 2, minRows = 3, className, value, onChange, onReset, ...props }, ref) => {
    const internalRef = useRef<HTMLTextAreaElement>(null);
    const textareaRef = internalRef;
    const initialHeightRef = useRef<number>(0);

    // é‡ç½®é«˜åº¦åˆ°åˆå§‹çŠ¶æ€
    const resetHeight = () => {
      const textarea = textareaRef.current;
      if (textarea && initialHeightRef.current > 0) {
        textarea.style.height = `${initialHeightRef.current}px`;
        textarea.style.overflowY = 'hidden';
        onReset?.();
      }
    };

    // æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶
    useImperativeHandle(ref, () => ({
      resetHeight,
      focus: () => textareaRef.current?.focus(),
    }), []);

    // è·å–åˆå§‹é«˜åº¦
    useEffect(() => {
      const textarea = textareaRef.current;
      if (textarea && initialHeightRef.current === 0) {
        textarea.style.height = 'auto';
        const naturalHeight = textarea.scrollHeight;
        initialHeightRef.current = naturalHeight;
        textarea.style.height = `${naturalHeight}px`;
      }
    }, []);

    // è‡ªåŠ¨è°ƒæ•´é«˜åº¦
    useEffect(() => {
      const textarea = textareaRef.current;
      if (textarea && initialHeightRef.current > 0) {
        textarea.style.height = 'auto';
        const scrollHeight = textarea.scrollHeight;
        const maxHeight = initialHeightRef.current * maxHeightMultiplier;
        
        if (scrollHeight <= maxHeight) {
          textarea.style.height = `${Math.max(scrollHeight, initialHeightRef.current)}px`;
          textarea.style.overflowY = 'hidden';
        } else {
          textarea.style.height = `${maxHeight}px`;
          textarea.style.overflowY = 'auto';
        }
      }
    }, [value, maxHeightMultiplier]);

    return (
      <textarea
        ref={textareaRef}
        value={value}
        onChange={onChange}
        rows={minRows}
        className={cn(
          'w-full bg-transparent text-foreground placeholder:text-secondary-foreground',
          'text-base leading-relaxed resize-none border-none outline-none focus:ring-0',
          'py-4 min-h-[70px]', // ç»Ÿä¸€çš„å†…è¾¹è·å’Œæœ€å°é«˜åº¦
          className
        )}
        {...props}
      />
    );
  }
);

AutoResizeTextarea.displayName = 'AutoResizeTextarea';


      ================================================================================
      æ–‡ä»¶å: Button.tsx
      è·¯å¾„: Button.tsx
      ================================================================================

      // src/components/ui/Button.tsx
// é€šç”¨æŒ‰é’®ç»„ä»¶ - æ”¯æŒå¤šç§å˜ä½“å’Œå°ºå¯¸
import React, { type ComponentProps } from 'react';
import { cn } from '@/lib/utils';

interface ButtonProps extends ComponentProps<'button'> {
  variant?: 'primary' | 'secondary' | 'ghost' | 'outline';
  size?: 'sm' | 'md' | 'lg';
  icon?: React.ReactNode;
  iconOnly?: boolean;
  loading?: boolean;
}

export const Button: React.FC<ButtonProps> = ({
  variant = 'primary',
  size = 'md',
  icon,
  iconOnly = false,
  loading = false,
  className,
  children,
  disabled,
  ...props
}) => {
  const isDisabled = disabled || loading;

  // åŸºç¡€æ ·å¼
  const baseStyles = [
    'inline-flex items-center justify-center',
    'font-medium transition-all duration-300',
    'focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2',
    'disabled:cursor-not-allowed'
  ];

  // å˜ä½“æ ·å¼
  const variantStyles = {
    primary: [
      'bg-foreground text-background',
      'shadow-lg shadow-black/30',
      'hover:scale-105 hover:shadow-xl hover:shadow-black/40',
      'disabled:bg-muted disabled:text-muted-foreground/50 disabled:shadow-sm disabled:shadow-black/10 disabled:hover:scale-100'
    ],
    secondary: [
      'bg-secondary text-secondary-foreground',
      'shadow-md shadow-black/20',
      'hover:bg-secondary/80',
      'disabled:bg-muted disabled:text-muted-foreground/50'
    ],
    ghost: [
      'bg-transparent text-foreground',
      'hover:bg-white/[.02]',
      'disabled:text-muted-foreground/50'
    ],
    outline: [
      'bg-transparent text-foreground border border-border',
      'hover:bg-white/[.02] hover:border-foreground/30',
      'disabled:text-muted-foreground/50 disabled:border-border/50'
    ]
  };

  // å°ºå¯¸æ ·å¼
  const sizeStyles = {
    sm: iconOnly ? 'p-1.5 rounded-lg' : 'px-3 py-1.5 text-sm rounded-lg',
    md: iconOnly ? 'p-2 rounded-xl' : 'px-4 py-2 text-base rounded-xl',
    lg: iconOnly ? 'p-3 rounded-xl' : 'px-6 py-3 text-lg rounded-xl'
  };

  return (
    <button
      className={cn(
        baseStyles,
        variantStyles[variant],
        sizeStyles[size],
        className
      )}
      disabled={isDisabled}
      {...props}
    >
      {loading && (
        <div className="mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
      )}
      {icon && !loading && (
        <span className={cn(iconOnly ? '' : 'mr-2')}>
          {icon}
        </span>
      )}
      {!iconOnly && children}
    </button>
  );
};


      ================================================================================
      æ–‡ä»¶å: ConnectionStatus.tsx
      è·¯å¾„: ConnectionStatus.tsx
      ================================================================================

      // src/components/ui/ConnectionStatus.tsx
// WebSocketè¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ç»„ä»¶

import React, { useEffect, useState } from 'react';
import wsManager from '@/services/websocket/manager';
import type { ConnectionStatusChangeEvent } from '@/services/websocket/protocol';

interface ConnectionStatusProps {
  className?: string;
}

export const ConnectionStatus: React.FC<ConnectionStatusProps> = ({ className = '' }) => {
  const [status, setStatus] = useState<ConnectionStatusChangeEvent | null>(null);
  const [isVisible, setIsVisible] = useState(false);

  // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼
  const useMockData = import.meta.env.VITE_USE_MOCK_DATA === 'true';

  useEffect(() => {
    if (useMockData) {
      // æ¨¡æ‹Ÿæ¨¡å¼ä¸‹æ˜¾ç¤ºæ¨¡æ‹ŸçŠ¶æ€
      setStatus({
        status: 'connected',
        timestamp: new Date().toISOString(),
        reconnectAttempts: 0,
      });
      setIsVisible(true);
      return;
    }

    // çœŸå®æ¨¡å¼ä¸‹ç›‘å¬WebSocketçŠ¶æ€å˜åŒ–
    const handleStatusChange = (statusEvent: ConnectionStatusChangeEvent) => {
      setStatus(statusEvent);
      
      // åªåœ¨éè¿æ¥çŠ¶æ€æ—¶æ˜¾ç¤ºæŒ‡ç¤ºå™¨
      setIsVisible(statusEvent.status !== 'connected');
      
      // è¿æ¥æˆåŠŸå3ç§’éšè—æŒ‡ç¤ºå™¨
      if (statusEvent.status === 'connected') {
        setTimeout(() => setIsVisible(false), 3000);
      }
    };

    wsManager.onStatusChange(handleStatusChange);

    return () => {
      // æ¸…ç†ç›‘å¬å™¨ï¼ˆå¦‚æœWebSocketManageræ”¯æŒçš„è¯ï¼‰
    };
  }, [useMockData]);

  if (!isVisible || !status) {
    return null;
  }

  const getStatusIndicator = () => {
    // éµå¾ªç°åº¦é“å¾‹ï¼šåªä½¿ç”¨ç°åº¦ï¼Œé€šè¿‡é€æ˜åº¦å’ŒåŠ¨ç”»è¡¨è¾¾çŠ¶æ€
    switch (status.status) {
      case 'connected':
        return 'bg-white/20'; // è¿æ¥æˆåŠŸï¼šè¾ƒäº®çš„ç°åº¦
      case 'connecting':
        return 'bg-white/10 animate-pulse'; // è¿æ¥ä¸­ï¼šè„‰åŠ¨åŠ¨ç”»
      case 'reconnecting':
        return 'bg-white/15 animate-pulse'; // é‡è¿ä¸­ï¼šä¸­ç­‰äº®åº¦è„‰åŠ¨
      case 'disconnected':
        return 'bg-white/5'; // æ–­å¼€ï¼šæœ€æš—çš„ç°åº¦
      default:
        return 'bg-white/8';
    }
  };

  const getStatusText = () => {
    if (useMockData) {
      return 'ğŸ­ æ¨¡æ‹Ÿæ¨¡å¼';
    }

    switch (status.status) {
      case 'connected':
        return 'ğŸ”— å·²è¿æ¥';
      case 'connecting':
        return 'ğŸ”„ è¿æ¥ä¸­...';
      case 'reconnecting':
        return `ğŸ”„ é‡è¿ä¸­... (${status.reconnectAttempts}/5)`;
      case 'disconnected':
        return 'âŒ è¿æ¥æ–­å¼€';
      default:
        return 'â“ æœªçŸ¥çŠ¶æ€';
    }
  };

  return (
    <div className={`fixed top-4 right-4 z-50 ${className}`}>
      {/* éµå¾ªæ ‡å‡†æè´¨ï¼šåŠé€æ˜èƒŒæ™¯ã€æ¨¡ç³Šæ•ˆæœã€çº¤ç»†è¾¹æ¡†ã€æŸ”å’Œé˜´å½± */}
      <div className="flex items-center space-x-3 bg-card/75 backdrop-blur-xl border border-border shadow-lg shadow-black/20 rounded-lg px-4 py-2 text-sm text-foreground transition-colors duration-300 ease-in-out">
        <div className={`w-2 h-2 rounded-full ${getStatusIndicator()}`} />
        <span className="text-sm">{getStatusText()}</span>
        {status.error && (
          <span className="text-xs text-muted-foreground">({status.error})</span>
        )}
      </div>
    </div>
  );
};

export default ConnectionStatus;


      ================================================================================
      æ–‡ä»¶å: index.ts
      è·¯å¾„: index.ts
      ================================================================================

      // src/components/ui/index.ts
// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰UIç»„ä»¶ï¼Œä¾¿äºä½¿ç”¨

export { MarkdownRenderer } from './MarkdownRenderer';
export { RoleSymbol } from './RoleSymbol';
export { Button } from './Button';
export { Timestamp } from './Timestamp';
export { AutoResizeTextarea } from './AutoResizeTextarea';

// å¯¼å‡ºç±»å‹å®šä¹‰
export type { AutoResizeTextareaRef } from './AutoResizeTextarea';

// æœªæ¥çš„UIç»„ä»¶å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ 
// export { Input } from './Input';


      ================================================================================
      æ–‡ä»¶å: MarkdownRenderer.tsx
      è·¯å¾„: MarkdownRenderer.tsx
      ================================================================================

      // src/components/ui/MarkdownRenderer.tsx
// Markdownæ¸²æŸ“å™¨ - éµå¾ªç°åº¦ä¸­åº¸è®¾è®¡å“²å­¦ï¼Œé›†æˆæ‰€æœ‰markdownç›¸å…³ç»„ä»¶
import React, { useState } from 'react';
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import { Copy, Check } from 'lucide-react';
import { cn } from '@/lib/utils';

// ===== å†…éƒ¨ç»„ä»¶å®šä¹‰ =====

// å†…è”ä»£ç ç»„ä»¶
interface InlineCodeProps {
  children: React.ReactNode;
  className?: string;
}

const InlineCode: React.FC<InlineCodeProps> = ({ children, className }) => {
  return (
    <code className={cn(
      'inline',
      'px-1.5 py-0.5',
      'text-base font-mono', // ä» text-sm æ”¹ä¸º text-baseï¼Œç¨å¾®å¤§ä¸€äº›
      'bg-muted/40 text-foreground',
      'rounded-sm',
      'break-words',
      className
    )}>
      {children}
    </code>
  );
};

// ä»£ç å—ç»„ä»¶
interface CodeBlockProps {
  code: string;
  language?: string;
  filename?: string;
  showLineNumbers?: boolean;
  className?: string;
}

const CodeBlock: React.FC<CodeBlockProps> = ({
  code,
  language,
  filename,
  showLineNumbers = false,
  className
}) => {
  const [copied, setCopied] = useState(false);

  const handleCopy = async () => {
    try {
      await navigator.clipboard.writeText(code);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch (err) {
      console.error('Failed to copy code:', err);
    }
  };

  const lines = code.split('\n');

  return (
    <div className={cn(
      'group relative rounded-xl overflow-hidden my-4', // æ·»åŠ å¤–è¾¹è·
      'bg-card/75 backdrop-blur-xl',
      'border border-border',
      'shadow-lg shadow-black/20',
      'transition-all duration-300',
      'hover:border-foreground/20 hover:shadow-xl hover:shadow-black/30',
      className
    )}>
      {/* å¤´éƒ¨ä¿¡æ¯æ  */}
      {(filename || language) && (
        <div className="flex items-center justify-between px-3 py-2 border-b border-border/50 bg-muted/30">
          <div className="flex items-center space-x-3">
            {filename && (
              <span className="text-sm font-medium text-foreground">
                {filename}
              </span>
            )}
            {language && (
              <span className="text-xs text-secondary-foreground font-mono uppercase tracking-wider">
                {language}
              </span>
            )}
          </div>

          <button
            onClick={handleCopy}
            className={cn(
              'p-1.5 text-secondary-foreground/60 rounded',
              'opacity-0 group-hover:opacity-100 transition-all duration-200',
              'hover:text-secondary-foreground hover:bg-muted/50',
              'focus:outline-none focus:text-secondary-foreground focus:bg-muted/50'
            )}
            aria-label={copied ? "å·²å¤åˆ¶" : "å¤åˆ¶ä»£ç "}
          >
            <div className="transition-all duration-200">
              {copied ? <Check size={14} /> : <Copy size={14} />}
            </div>
          </button>
        </div>
      )}

      {/* ä»£ç å†…å®¹åŒºåŸŸ */}
      <div className="relative">
        {/* å¤åˆ¶æŒ‰é’®ï¼ˆæ— å¤´éƒ¨ä¿¡æ¯æ—¶æ˜¾ç¤ºï¼‰ */}
        {!filename && !language && (
          <button
            onClick={handleCopy}
            className={cn(
              'absolute top-3 right-3 z-10 p-1.5 rounded',
              'text-secondary-foreground/60 bg-card/50 backdrop-blur-sm',
              'opacity-0 group-hover:opacity-100 transition-all duration-200',
              'hover:text-secondary-foreground hover:bg-muted/50',
              'focus:outline-none focus:text-secondary-foreground focus:bg-muted/50'
            )}
            aria-label={copied ? "å·²å¤åˆ¶" : "å¤åˆ¶ä»£ç "}
          >
            <div className="transition-all duration-200">
              {copied ? <Check size={14} /> : <Copy size={14} />}
            </div>
          </button>
        )}

        <pre className={cn(
          'overflow-x-auto p-4',
          'text-sm leading-relaxed',
          'font-mono',
          !filename && !language && 'pr-12' // ä¸ºå¤åˆ¶æŒ‰é’®ç•™å‡ºç©ºé—´
        )}>
          <code className="text-foreground">
            {showLineNumbers ? (
              <div className="table w-full">
                {lines.map((line, index) => (
                  <div key={index} className="table-row">
                    <span className="table-cell pr-4 text-secondary-foreground/50 text-right select-none w-8 min-w-8">
                      {index + 1}
                    </span>
                    <span className="table-cell">
                      {line || '\u00A0'} {/* ç©ºè¡Œæ˜¾ç¤ºä¸ºä¸é—´æ–­ç©ºæ ¼ */}
                    </span>
                  </div>
                ))}
              </div>
            ) : (
              code
            )}
          </code>
        </pre>
      </div>
    </div>
  );
};

// è¡¨æ ¼ç»„ä»¶
interface TableProps {
  children: React.ReactNode;
  className?: string;
}

interface TableHeaderProps {
  children: React.ReactNode;
  className?: string;
}

interface TableBodyProps {
  children: React.ReactNode;
  className?: string;
}

interface TableRowProps {
  children: React.ReactNode;
  className?: string;
}

interface TableHeadProps {
  children: React.ReactNode;
  className?: string;
}

interface TableCellProps {
  children: React.ReactNode;
  className?: string;
}

// ä¸»è¡¨æ ¼å®¹å™¨
const Table: React.FC<TableProps> = ({ children, className }) => (
  <div className="w-full overflow-x-auto my-4"> {/* æ·»åŠ æ°´å¹³æ»šåŠ¨å’Œå¤–è¾¹è· */}
    <table className={cn(
      'w-full border-collapse',
      'bg-card/30 backdrop-blur-sm',
      'border border-border/40',
      'rounded-lg overflow-hidden',
      'min-w-full', // ç¡®ä¿è¡¨æ ¼æœ€å°å®½åº¦
      className
    )}>
      {children}
    </table>
  </div>
);

// è¡¨æ ¼å¤´éƒ¨
const TableHeader: React.FC<TableHeaderProps> = ({ children, className }) => (
  <thead className={cn(
    'bg-card/50 backdrop-blur-sm',
    'border-b border-border/40',
    className
  )}>
    {children}
  </thead>
);

// è¡¨æ ¼ä¸»ä½“
const TableBody: React.FC<TableBodyProps> = ({ children, className }) => (
  <tbody className={cn(className)}>
    {children}
  </tbody>
);

// è¡¨æ ¼è¡Œ
const TableRow: React.FC<TableRowProps> = ({ children, className }) => (
  <tr className={cn(
    'border-b border-border/20 last:border-b-0',
    'hover:bg-muted/20 transition-colors duration-200', // ä¿®å¤ï¼šæ›´æ˜æ˜¾çš„æ‚¬åœæ•ˆæœ
    className
  )}>
    {children}
  </tr>
);

// è¡¨æ ¼å¤´å•å…ƒæ ¼
const TableHead: React.FC<TableHeadProps> = ({ children, className }) => (
  <th className={cn(
    'px-4 py-3 text-left',
    'text-sm font-semibold text-foreground',
    'border-r border-border/20 last:border-r-0',
    'whitespace-nowrap', // é˜²æ­¢æ ‡é¢˜æ¢è¡Œ
    className
  )}>
    {children}
  </th>
);

// è¡¨æ ¼æ•°æ®å•å…ƒæ ¼
const TableCell: React.FC<TableCellProps> = ({ children, className }) => (
  <td className={cn(
    'px-4 py-3',
    'text-sm text-secondary-foreground',
    'border-r border-border/20 last:border-r-0',
    className
  )}>
    {children}
  </td>
);

interface MarkdownRendererProps {
  content: string;
  className?: string; // æ·»åŠ å¯é€‰çš„å¤–éƒ¨æ ·å¼
}

export const MarkdownRenderer: React.FC<MarkdownRendererProps> = ({ 
  content, 
  className 
}) => {
  return (
    <div className={cn("w-full prose max-w-none", className)}>
      <ReactMarkdown
        remarkPlugins={[remarkGfm]}
        components={{
          // ä»£ç å—ç»„ä»¶
          code: ({ node, inline, className, children, ...props }: any) => {
            const match = /language-(\w+)/.exec(className || '');
            const language = match ? match[1] : undefined;

            // ä¿®å¤ inline åˆ¤æ–­ï¼šå¦‚æœæ²¡æœ‰æ¢è¡Œç¬¦ä¸”æ²¡æœ‰è¯­è¨€ç±»ï¼Œåˆ™è®¤ä¸ºæ˜¯è¡Œå†…ä»£ç 
            const codeContent = String(children);
            const isInlineCode = inline !== false && (!codeContent.includes('\n') && !language);

            if (isInlineCode) {
              return <InlineCode {...props}>{children}</InlineCode>;
            }

            return (
              <CodeBlock
                code={codeContent.replace(/\n$/, '')}
                language={language}
                showLineNumbers={false}
                {...props}
              />
            );
          },

          // è‡ªå®šä¹‰è¡¨æ ¼ç»„ä»¶
          table: ({ children }) => (
            <Table>{children}</Table>
          ),

          thead: ({ children }) => <TableHeader>{children}</TableHeader>,
          tbody: ({ children }) => <TableBody>{children}</TableBody>,
          tr: ({ children }) => <TableRow>{children}</TableRow>,
          th: ({ children }) => <TableHead>{children}</TableHead>,
          td: ({ children }) => <TableCell>{children}</TableCell>,

          // ä¼˜åŒ–å…¶ä»–å…ƒç´ 
          p: ({ children }) => (
            <p className="text-foreground leading-relaxed mb-4 last:mb-0">
              {children}
            </p>
          ),

          blockquote: ({ children }) => (
            <blockquote className="border-l-4 border-primary/30 bg-muted/30 pl-4 py-2 italic text-secondary-foreground my-4 rounded-r">
              {children}
            </blockquote>
          ),

          hr: () => (
            <hr className="border-border my-8" />
          ),

          // æ ‡é¢˜ç»„ä»¶ - æ·»åŠ é”šç‚¹æ”¯æŒ
          h1: ({ children, id }) => (
            <h1 
              id={id}
              className="text-3xl font-bold text-foreground mb-6 mt-8 first:mt-0 leading-tight scroll-mt-16"
            >
              {children}
            </h1>
          ),

          h2: ({ children, id }) => (
            <h2 
              id={id}
              className="text-2xl font-semibold text-foreground mb-4 mt-6 first:mt-0 leading-tight scroll-mt-16"
            >
              {children}
            </h2>
          ),

          h3: ({ children, id }) => (
            <h3 
              id={id}
              className="text-xl font-semibold text-foreground mb-3 mt-5 first:mt-0 leading-tight scroll-mt-16"
            >
              {children}
            </h3>
          ),

          h4: ({ children, id }) => (
            <h4 
              id={id}
              className="text-lg font-semibold text-foreground mb-2 mt-4 first:mt-0 leading-tight scroll-mt-16"
            >
              {children}
            </h4>
          ),

          h5: ({ children, id }) => (
            <h5 
              id={id}
              className="text-base font-semibold text-foreground mb-2 mt-4 first:mt-0 leading-tight scroll-mt-16"
            >
              {children}
            </h5>
          ),

          h6: ({ children, id }) => (
            <h6 
              id={id}
              className="text-sm font-semibold text-secondary-foreground mb-2 mt-3 first:mt-0 leading-tight uppercase tracking-wider scroll-mt-16"
            >
              {children}
            </h6>
          ),

// æ— åºåˆ—è¡¨ç»„ä»¶ - ç®€åŒ–é€»è¾‘ï¼Œä¾èµ–CSSå¤„ç†åµŒå¥—
ul: ({ children }) => (
  <ul className="my-4 pl-0 list-none space-y-1.0">
    {children}
  </ul>
),

ol: ({ children, start }: any) => {
  // ä½¿ç”¨çŠ¶æ€æ¥è·Ÿè¸ªè®¡æ•°å™¨
  let counter = start || 1;

  return (
    <ol className="my-4 pl-0 list-none space-y-1.0">
      {React.Children.map(children, (child, index) => {
        if (React.isValidElement(child)) {
          return React.cloneElement(child as React.ReactElement<any>, {
            ...(child.props || {}),
            key: index,
            'data-list-number': counter++,
            'data-is-ordered': true
          });
        }
        return child;
      })}
    </ol>
  );
},

li: ({ children, ...props }: any) => {
  const isOrdered = props['data-is-ordered'];
  const listNumber = props['data-list-number'];

  return (
    <li className="flex text-foreground leading-relaxed">
      <span className="flex-shrink-0 text-secondary-foreground/70 select-none mr-2.5 flex items-center h-7">
        {isOrdered ? (
          <span className="text-sm font-medium min-w-[1.2rem] text-right inline-block">
            {listNumber}.
          </span>
        ) : (
          // åœ†ç‚¹åœ¨å›ºå®šé«˜åº¦å®¹å™¨ä¸­å‚ç›´å±…ä¸­ï¼Œä¸æ–‡æœ¬è¡Œé«˜åŒ¹é…
          <span className="w-1.5 h-1.5 bg-secondary-foreground/60 rounded-full" />
        )}
      </span>
      <div className="flex-1 min-w-0">
        {children}
      </div>
    </li>
  );
},

          // é“¾æ¥ç»„ä»¶ - å¾®å¦™çš„äº¤äº’æ•ˆæœï¼Œç¬¦åˆç°åº¦ä¸­åº¸å“²å­¦
          a: ({ href, children }) => (
            <a
              href={href}
              className={cn(
                'text-foreground underline decoration-secondary-foreground/30 decoration-1 underline-offset-2',
                'transition-all duration-300 ease-in-out',
                'hover:text-primary hover:decoration-secondary-foreground/50',
                'focus:outline-none focus:ring-1 focus:ring-secondary-foreground/20 focus:rounded-sm'
              )}
              target={href?.startsWith('http') ? '_blank' : undefined}
              rel={href?.startsWith('http') ? 'noopener noreferrer' : undefined}
            >
              {children}
            </a>
          ),

          // æ–‡æœ¬æ ·å¼ç»„ä»¶
          strong: ({ children }) => (
            <strong className="font-semibold text-foreground">
              {children}
            </strong>
          ),

          em: ({ children }) => (
            <em className="italic text-foreground">
              {children}
            </em>
          ),

          // æ·»åŠ å›¾ç‰‡ç»„ä»¶
          img: ({ src, alt, title }) => (
            <img
              src={src}
              alt={alt}
              title={title}
              className="max-w-full h-auto rounded-lg border border-border my-4"
              loading="lazy"
            />
          ),
        }}
      >
        {content}
      </ReactMarkdown>
    </div>
  );
};

      ================================================================================
      æ–‡ä»¶å: RoleSymbol.tsx
      è·¯å¾„: RoleSymbol.tsx
      ================================================================================

      // src/components/ui/RoleSymbol.tsx
// è§’è‰²ç¬¦å·ç»„ä»¶ - ä½¿ç”¨çº¯æ–‡æœ¬å‡ ä½•ç¬¦å·è¡¨ç¤ºä¸åŒè§’è‰²
import React from 'react';
import { motion } from 'framer-motion';
import { cn } from '@/lib/utils';

interface RoleSymbolProps {
  role: 'yu' | 'xi' | 'system';
  isThinking?: boolean;
}

// è§’è‰²ç¬¦å·æ˜ å°„ - ç‹¬ç«‹ä¸€åˆ—æ˜¾ç¤ºï¼Œå°ºå¯¸å¢å¤§
export const RoleSymbol: React.FC<RoleSymbolProps> = ({ role, isThinking = false }) => {
  const symbols = {
    yu: 'â–²',
    xi: 'â—',
    system: 'â– '
  };

  return (
    <motion.div
      className={cn(
        'flex items-center justify-center w-8 h-8',
        'text-secondary-foreground text-lg font-mono select-none',
        'flex-shrink-0', // é˜²æ­¢æ”¶ç¼©
        isThinking && 'animate-pulse'
      )}
      animate={isThinking ? { opacity: [0.4, 1, 0.4] } : {}}
      transition={isThinking ? { duration: 2, repeat: Infinity, ease: 'easeInOut' } : {}}
    >
      {symbols[role]}
    </motion.div>
  );
};


      ================================================================================
      æ–‡ä»¶å: Timestamp.tsx
      è·¯å¾„: Timestamp.tsx
      ================================================================================

      // src/components/ui/Timestamp.tsx
// æ™ºèƒ½æ—¶é—´æ˜¾ç¤ºç»„ä»¶ - æ”¯æŒç›¸å¯¹æ—¶é—´å’Œæ‚¬åœæ˜¾ç¤º
import React from 'react';
import { cn } from '@/lib/utils';

interface TimestampProps {
  date: Date;
  format?: 'time' | 'date' | 'datetime' | 'smart';
  className?: string;
  showOnHover?: boolean; // æ˜¯å¦åªåœ¨æ‚¬åœæ—¶æ˜¾ç¤º
}

export const Timestamp: React.FC<TimestampProps> = ({
  date,
  format = 'smart',
  className,
  showOnHover = false
}) => {
  const getSmartTime = (date: Date) => {
    const now = new Date();
    const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);
    const diffInDays = Math.floor(diffInSeconds / 86400);

    // ä»Šå¤©çš„æ¶ˆæ¯æ˜¾ç¤ºæ—¶é—´
    if (diffInDays === 0) {
      return date.toLocaleTimeString('zh-CN', {
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });
    }

    // 1-6å¤©å‰æ˜¾ç¤º"Xå¤©å‰"
    if (diffInDays <= 6) {
      return `${diffInDays}å¤©å‰`;
    }

    // 7å¤©ä»¥ä¸Šæ˜¾ç¤ºæœˆæ—¥
    if (diffInDays <= 365) {
      return date.toLocaleDateString('zh-CN', {
        month: 'short',
        day: 'numeric'
      });
    }

    // è¶…è¿‡ä¸€å¹´æ˜¾ç¤ºå¹´æœˆæ—¥
    return date.toLocaleDateString('zh-CN', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    });
  };

  const formatTime = (date: Date, format: string) => {
    switch (format) {
      case 'time':
        return date.toLocaleTimeString('zh-CN', {
          hour: '2-digit',
          minute: '2-digit',
          hour12: false
        });
      case 'date':
        return date.toLocaleDateString('zh-CN');
      case 'datetime':
        return date.toLocaleString('zh-CN');
      case 'smart':
        return getSmartTime(date);
      default:
        return getSmartTime(date);
    }
  };

  const getFullDateTime = (date: Date) => {
    return date.toLocaleString('zh-CN', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false
    });
  };

  return (
    <time
      dateTime={date.toISOString()}
      title={getFullDateTime(date)}
      className={cn(
        'text-xs text-secondary-foreground/60 select-none transition-opacity duration-200',
        showOnHover && 'opacity-0 group-hover:opacity-100',
        className
      )}
    >
      {formatTime(date, format)}
    </time>
  );
};


    ================================================================================
    æ–‡ä»¶å: index.ts
    è·¯å¾„: index.ts
    ================================================================================

    // src/components/index.ts
// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ç»„ä»¶å±‚

// UIç»„ä»¶å±‚ - åŸå­çº§çº¯UIç»„ä»¶
export * from './ui';

// Commonç»„ä»¶å±‚ - å¤åˆ/å·¥å…·ç»„ä»¶
export * from './common';

// ä½¿ç”¨ç¤ºä¾‹ï¼š
// import { MarkdownRenderer, RoleSymbol } from '@/components'; // UIç»„ä»¶
// import { ErrorBoundary, LoadingState } from '@/components';     // Commonç»„ä»¶


  ------------------------------------------------------------
  æ–‡ä»¶å¤¹: features
  ------------------------------------------------------------


    ------------------------------------------------------------
    æ–‡ä»¶å¤¹: chat
    ------------------------------------------------------------


      ------------------------------------------------------------
      æ–‡ä»¶å¤¹: components
      ------------------------------------------------------------


        ================================================================================
        æ–‡ä»¶å: ChatInput.tsx
        è·¯å¾„: ChatInput.tsx
        ================================================================================

        // src/features/chat/components/ChatInput.tsx
import { ArrowUp } from 'lucide-react';
import { useRef, useState } from 'react';
import { cn } from '@/lib/utils';
import { Button, AutoResizeTextarea, type AutoResizeTextareaRef } from '@/components/ui';

interface ChatInputProps {
  onSendMessage: (message: string) => void;
  disabled?: boolean;
  isInitialState?: boolean;
}

export const ChatInput: React.FC<ChatInputProps> = ({ onSendMessage, disabled = false, isInitialState: _isInitialState = false }) => {
  // æ³¨æ„ï¼šisInitialState å‚æ•°ä¿ç•™ç”¨äºæ¥å£å…¼å®¹æ€§ï¼Œä½†ç°åœ¨æ‰€æœ‰çŠ¶æ€ä¸‹éƒ½ä½¿ç”¨ç»Ÿä¸€æ ·å¼
  const [message, setMessage] = useState('');
  const [isComposing, setIsComposing] = useState(false);
  const textareaRef = useRef<AutoResizeTextareaRef>(null);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (message.trim() && !disabled && !isComposing) {
      onSendMessage(message.trim());
      setMessage('');

      // é‡ç½® textarea é«˜åº¦
      textareaRef.current?.resetHeight();
    }
  };

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey && !isComposing) {
      e.preventDefault();
      handleSubmit(e);
    }
  };

  const canSend = message.trim().length > 0 && !disabled && !isComposing;

  return (
    <div className="w-full max-w-2xl mx-auto">
      <form onSubmit={handleSubmit} className="relative">
        <div className={cn(
          'relative rounded-2xl border border-border shadow-lg shadow-black/20',
          'bg-card/75 backdrop-blur-xl',
          'transition-colors duration-200',
          'hover:border-foreground/20'
        )}>
          <AutoResizeTextarea
            ref={textareaRef}
            value={message}
            onChange={(e) => setMessage(e.target.value)}
            onKeyDown={handleKeyDown}
            onCompositionStart={() => setIsComposing(true)}
            onCompositionEnd={() => setIsComposing(false)}
            placeholder="ç»§ç»­æ¢ç´¢..."
            disabled={disabled}
            maxHeightMultiplier={2}
            minRows={3}
            className="px-4 pr-12"
          />
          <Button
            type="submit"
            variant="primary"
            size="md"
            icon={<ArrowUp size={18} />}
            iconOnly
            disabled={!canSend}
            className="absolute right-2 bottom-2"
          />
        </div>
      </form>
    </div>
  );
};

        ================================================================================
        æ–‡ä»¶å: ChatMessage.tsx
        è·¯å¾„: ChatMessage.tsx
        ================================================================================

        // src/features/chat/components/ChatMessage.tsx
// æ¶ˆæ¯ç»„ä»¶ - é›†æˆæµå¼æ¸²æŸ“å¼•æ“ï¼Œå®ç°æ•°æ®ä¸æ¸²æŸ“åˆ†ç¦»
import React from 'react';
import { motion } from 'framer-motion';
// import { cn } from '@/lib/utils'; // æš‚æ—¶æœªä½¿ç”¨
import { MarkdownRenderer } from '@/components/ui/MarkdownRenderer';
import { Timestamp } from '@/components/ui/Timestamp';
import { RoleSymbol } from '@/components/ui/RoleSymbol';
import { useTypewriter } from '../hooks/useTypewriter';
import type { Message } from '../types';

interface ChatMessageProps {
  message: Message;
  isLastMessage: boolean;
  isThinking: boolean;
}



export const ChatMessage: React.FC<ChatMessageProps> = ({ message, isLastMessage, isThinking }) => {
  const isXiThinking = message.role === 'xi' && isLastMessage && isThinking;
  const isStreaming = message.metadata?.isStreaming ?? false;

  // ä½¿ç”¨æµå¼æ¸²æŸ“å¼•æ“
  const { displayedContent } = useTypewriter({
    targetContent: message.content,
    isStreamingMessage: isStreaming,
  });

  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4, ease: 'easeOut' }}
      className="group relative py-6 flex items-start gap-4"
      data-message-id={message.id}
    >
      {/* å·¦ä¾§ï¼šè§’è‰²ç¬¦å·ç‹¬ç«‹ä¸€åˆ— */}
      <RoleSymbol role={message.role} isThinking={isXiThinking} />

      {/* å³ä¾§ï¼šæ¶ˆæ¯å†…å®¹åŒºåŸŸ */}
      <div className="flex-1 min-w-0 relative">
        {/* æ—¶é—´æˆ³ - æ‚¬åœæ˜¾ç¤ºï¼Œå³ä¸Šè§’ */}
        <div className="absolute top-0 right-0">
          <Timestamp
            date={new Date(message.timestamp)}
            format="smart"
            showOnHover={true}
          />
        </div>

        {/* æ¶ˆæ¯å†…å®¹ - ä½¿ç”¨æµå¼æ¸²æŸ“å¼•æ“è¾“å‡º */}
        <div className="pr-16"> {/* å³è¾¹è·ä¸ºæ—¶é—´æˆ³ç•™å‡ºç©ºé—´ */}
          <MarkdownRenderer content={displayedContent} />
        </div>
      </div>
    </motion.div>
  );
};


        ================================================================================
        æ–‡ä»¶å: ChatView.tsx
        è·¯å¾„: ChatView.tsx
        ================================================================================

        // src/features/chat/components/ChatView.tsx
// èŠå¤©è§†å›¾ç»„ä»¶ - çº¯å±•ç¤ºç»„ä»¶
//
// èŒè´£ï¼š
// - æ¸²æŸ“èŠå¤©ç•Œé¢çš„æ‰€æœ‰è§†è§‰å…ƒç´ 
// - å¤„ç†åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ
// - å“åº”ç”¨æˆ·äº¤äº’ï¼ˆé€šè¿‡å›è°ƒå‡½æ•°ï¼‰
// - å±•ç¤ºæ¶ˆæ¯æµã€è¾“å…¥æ¡†ã€æŒ‰é’®ç­‰UIå…ƒç´ 
//
// è®¾è®¡åŸåˆ™ï¼š
// - çº¯å±•ç¤ºç»„ä»¶ï¼šä¸åŒ…å«ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†
// - é€šè¿‡propsæ¥æ”¶æ‰€æœ‰æ•°æ®å’Œå›è°ƒå‡½æ•°
// - ä¸“æ³¨äºUIæ¸²æŸ“å’Œç”¨æˆ·ä½“éªŒ
// - é›†æˆLogStreamçš„æ¶ˆæ¯æ¸²æŸ“é€»è¾‘

import React, { useMemo } from 'react';
import { motion, cubicBezier } from 'framer-motion';
import type { Message } from '../types';
import { ChatMessage } from './ChatMessage';
import { ChatInput } from './ChatInput';
import { ScrollToBottomButton } from './ScrollToBottomButton';
import { ConnectionStatus } from '@/components/ui/ConnectionStatus';

interface ChatViewProps {
  messages: Message[];
  isThinking: boolean;
  onSendMessage: (message: string) => void;
  scrollContainerRef: React.RefObject<HTMLDivElement>;
  showScrollButton: boolean;
  onScrollToBottom: () => void;
}

export const ChatView: React.FC<ChatViewProps> = ({
  messages,
  isThinking,
  onSendMessage,
  scrollContainerRef,
  showScrollButton,
  onScrollToBottom,
}) => {
  // æ˜¯å¦å·²å¼€å§‹ï¼ˆæ˜¯å¦å·²å­˜åœ¨ä»»æ„æ¶ˆæ¯ï¼‰
  const hasStarted = messages.length > 0;

  // è¾“å…¥åŒºåŸŸåŠ¨ç”»ï¼šå•ä¸€çˆ¶å®¹å™¨ä¸­ï¼Œé€šè¿‡ transform æ§åˆ¶ä»å±…ä¸­ -> åº•éƒ¨
  const inputMotion = useMemo(() => {
    return {
      initial: false as const, // é¿å…é¦–æ¬¡æŒ‚è½½æ—¶é—ªçƒ
      animate: hasStarted
        ? { y: 0, opacity: 1 }
        : { y: 'calc(-50vh + 4rem)', opacity: 1 }, 
      transition: {
        duration: 0.8,
        ease: cubicBezier(0.22, 1, 0.36, 1),
        type: 'tween' as const,
      },
    };
  }, [hasStarted]);

  // æ ‡é¢˜æ·¡å…¥æ·¡å‡º
  const titleMotion = useMemo(() => {
    return {
      initial: { opacity: 0 },
      animate: { opacity: hasStarted ? 0 : 1 },
      transition: { duration: 0.5, ease: cubicBezier(0.22, 1, 0.36, 1) },
    };
  }, [hasStarted]);

  return (
    <div className="h-screen bg-background text-foreground font-sans relative overflow-hidden">
      {/* ç»Ÿä¸€å¸ƒå±€ï¼šé¡¶éƒ¨å†…å®¹åŒº + ä¸­å¤®/åº•éƒ¨åŠ¨ç”»è¾“å…¥åŒº */}
      <div className="h-full relative">
        {/* æ»šåŠ¨æ¶ˆæ¯åŒºï¼šæ ¹æ® hasStarted æ§åˆ¶å¯è§æ€§ä¸å…¥åœº */}
        <motion.div
          className="h-full overflow-y-auto pb-32"
          style={{ scrollBehavior: 'auto' }}
          initial={{ opacity: 0 }}
          animate={{ opacity: hasStarted ? 1 : 0 }}
          transition={{ duration: 0.5, ease: cubicBezier(0.22, 1, 0.36, 1) }}
          ref={scrollContainerRef}
        >
          <div className="flex justify-center">
            {/* æ¶ˆæ¯æµæ¸²æŸ“ - é›†æˆåŸLogStreamé€»è¾‘ */}
            <div className="w-full max-w-3xl mx-auto px-4">
              {messages.map((message, index) => (
                <ChatMessage
                  key={message.id}
                  message={message}
                  isLastMessage={index === messages.length - 1}
                  isThinking={isThinking}
                />
              ))}
            </div>
          </div>
        </motion.div>

        {/* åˆå§‹æ ‡é¢˜ï¼šä»…åœ¨æœªå¼€å§‹æ—¶æ˜¾ç¤ºï¼Œä½äºé¡µé¢ä¸­å¿ƒä¸Šæ–¹æ›´å¤š */}
        <motion.div
          className="absolute inset-0 flex items-center justify-center pointer-events-none"
          {...titleMotion}
        >
          <h1 className="text-4xl font-light text-secondary-foreground tracking-[0.2em] -translate-y-32">
            YX NEXUS
          </h1>
        </motion.div>

        {/* è¾“å…¥åŒºåŸŸï¼šå•ä¸€çˆ¶å®¹å™¨å†…ï¼Œè¿‡æ¸¡ä»ä¸­å¿ƒ -> åº•éƒ¨ */}
        <motion.div
          className="absolute left-0 right-0 bottom-0 flex justify-center p-6"
          {...inputMotion}
        >
          <div className="w-full max-w-2xl">
            <ChatInput
              onSendMessage={onSendMessage}
              disabled={isThinking}
              isInitialState={!hasStarted}
            />
          </div>
        </motion.div>

        {/* æ»šåŠ¨åˆ°åº•éƒ¨æŒ‰é’® */}
        <ScrollToBottomButton
          show={showScrollButton && hasStarted}
          onClick={onScrollToBottom}
        />

        {/* WebSocketè¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ */}
        <ConnectionStatus />
      </div>
    </div>
  );
};


        ================================================================================
        æ–‡ä»¶å: ScrollToBottomButton.tsx
        è·¯å¾„: ScrollToBottomButton.tsx
        ================================================================================

        // src/features/chat/components/ScrollToBottomButton.tsx
// æ»šåŠ¨åˆ°åº•éƒ¨æŒ‰é’®ç»„ä»¶ - ç¬¦åˆè®¾è®¡ç³»ç»Ÿçš„æµ®åŠ¨æŒ‰é’®
import React from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronDown } from 'lucide-react';
import { cn } from '@/lib/utils';

interface ScrollToBottomButtonProps {
  /** æ˜¯å¦æ˜¾ç¤ºæŒ‰é’® */
  show: boolean;
  /** ç‚¹å‡»å›è°ƒ */
  onClick: () => void;
  /** è‡ªå®šä¹‰ç±»å */
  className?: string;
}

export const ScrollToBottomButton: React.FC<ScrollToBottomButtonProps> = ({
  show,
  onClick,
  className
}) => {
  return (
    <AnimatePresence>
      {show && (
        <motion.button
          initial={{ opacity: 0, y: 10, scale: 0.9 }}
          animate={{ opacity: 1, y: 0, scale: 1 }}
          exit={{ opacity: 0, y: 10, scale: 0.9 }}
          transition={{
            duration: 0.2,
            ease: [0.22, 1, 0.36, 1]
          }}
          onClick={onClick}
          className={cn(
            // åŸºç¡€æ ·å¼ - è°ƒæ•´ä½ç½®ä¸è¾“å…¥æ¡†å¯¹é½
            // bottom-[6.5rem] çº¦ç­‰äºè¾“å…¥æ¡†å®¹å™¨çš„é«˜åº¦ (p-6 + è¾“å…¥æ¡†é«˜åº¦)
            'fixed bottom-[6.5rem] right-6 z-10',
            'w-10 h-10 rounded-full',
            
            // æ ‡å‡†æè´¨
            'bg-card/75 backdrop-blur-xl',
            'border border-border',
            'shadow-lg shadow-black/20',
            
            // äº¤äº’çŠ¶æ€
            'hover:bg-white/[.02] active:scale-95',
            'transition-all duration-300 ease-in-out',
            
            // å†…å®¹å±…ä¸­
            'flex items-center justify-center',
            'text-secondary-foreground hover:text-foreground',
            
            className
          )}
          whileHover={{ scale: 1.05 }}
          whileTap={{ scale: 0.95 }}
        >
          <ChevronDown className="w-5 h-5" />
        </motion.button>
      )}
    </AnimatePresence>
  );
};


      ------------------------------------------------------------
      æ–‡ä»¶å¤¹: data
      ------------------------------------------------------------


        ================================================================================
        æ–‡ä»¶å: MOCK_DATA.md
        è·¯å¾„: MOCK_DATA.md
        ================================================================================

        # å‰ç«¯æ¨¡æ‹Ÿæ•°æ®åŠŸèƒ½

## æ¦‚è¿°

ä¸ºäº†æ–¹ä¾¿å‰ç«¯å¼€å‘å’Œæµ‹è¯•ç•Œé¢æ•ˆæœï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„æ¨¡æ‹Ÿæ•°æ®ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿå¯ä»¥åœ¨ä¸ä¾èµ–åç«¯æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œæä¾›ä¸°å¯Œçš„å¯¹è¯æ•°æ®å’Œäº¤äº’ä½“éªŒã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ­ äº¤äº’å¼æµ‹è¯•æ¨¡å¼
- **ç©ºç™½ç•Œé¢å¯åŠ¨**ï¼šä»æœ€åˆçš„æ‚¬æµ®æŒ‡ä»¤æ ¸å¿ƒå¼€å§‹
- **æ•°å­—æŒ‡ä»¤è§¦å‘**ï¼šé€šè¿‡è¾“å…¥1-5è§¦å‘ä¸åŒæµ‹è¯•åœºæ™¯
- **å®Œæ•´äº¤äº’æµç¨‹**ï¼šåŒ…å«å‘é€ã€æ€è€ƒã€æµå¼è¾“å‡ºçš„å®Œæ•´ä½“éªŒ
- **çœŸå®åŠ¨ç”»æ•ˆæœ**ï¼šæ‰€æœ‰UIç»„ä»¶å’Œè¿‡æ¸¡åŠ¨ç”»æ­£å¸¸å·¥ä½œ

### ğŸ¤– æ™ºèƒ½æµ‹è¯•å“åº”
- **åˆ†ç±»æµ‹è¯•å†…å®¹**ï¼š5ç§ä¸åŒç±»å‹çš„ä¸“é—¨æµ‹è¯•å“åº”
- **æµå¼è¾“å‡ºæ¨¡æ‹Ÿ**ï¼šå®Œæ•´çš„æ‰“å­—æœºæ•ˆæœå’Œæ€è€ƒåŠ¨ç”»
- **ç»„ä»¶åŠŸèƒ½éªŒè¯**ï¼šæ¯ç§å“åº”æµ‹è¯•ä¸åŒçš„UIç»„ä»¶
- **æ€§èƒ½æµ‹è¯•æ”¯æŒ**ï¼šé•¿æ–‡æœ¬ã€å¤æ‚æ ¼å¼çš„æ¸²æŸ“æµ‹è¯•

### ğŸ¨ å…¨é¢UIæµ‹è¯•è¦†ç›–
- **åŸºç¡€æ–‡æœ¬æ¸²æŸ“**ï¼šMarkdownã€ç²—ä½“ã€æ–œä½“ã€åˆ—è¡¨
- **ä»£ç è¯­æ³•é«˜äº®**ï¼šPythonã€JavaScriptç­‰å¤šè¯­è¨€æ”¯æŒ
- **è¡¨æ ¼å’Œå¼•ç”¨**ï¼šå¤æ‚æ ¼å¼å…ƒç´ çš„æ¸²æŸ“æµ‹è¯•
- **å·¥å…·è°ƒç”¨åŠ¨ç”»**ï¼šæ¨¡æ‹Ÿæœç´¢å’Œèƒ½åŠ›ä½¿ç”¨çš„è§†è§‰æ•ˆæœ
- **é•¿æ–‡æœ¬æ»šåŠ¨**ï¼šæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒæµ‹è¯•

## ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿåˆ‡æ¢æ¨¡å¼

ä½¿ç”¨æä¾›çš„è„šæœ¬å¿«é€Ÿåˆ‡æ¢æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼ï¼š

```bash
# å¯ç”¨æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼
node scripts/toggle-mock.cjs on

# ç¦ç”¨æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼ï¼ˆä½¿ç”¨çœŸå®åç«¯ï¼‰
node scripts/toggle-mock.cjs off

# æŸ¥çœ‹å½“å‰çŠ¶æ€
node scripts/toggle-mock.cjs
```

### æ‰‹åŠ¨é…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# å¯ç”¨æ¨¡æ‹Ÿæ•°æ®
VITE_USE_MOCK_DATA=true

# ç¦ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆé»˜è®¤ï¼‰
VITE_USE_MOCK_DATA=false
```

## æµ‹è¯•æŒ‡ä»¤è¯´æ˜

### æ•°å­—æŒ‡ä»¤ç³»ç»Ÿ
åœ¨æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼ä¸‹ï¼Œè¾“å…¥ä»¥ä¸‹æ•°å­—å¯è§¦å‘å¯¹åº”çš„æµ‹è¯•åœºæ™¯ï¼š

| æŒ‡ä»¤ | æµ‹è¯•å†…å®¹ | éªŒè¯åŠŸèƒ½ |
|------|----------|----------|
| **1** | åŸºç¡€æ–‡æœ¬å“åº” | Markdownæ¸²æŸ“ã€æ–‡æœ¬æ ¼å¼ã€åˆ—è¡¨æ˜¾ç¤º |
| **2** | å·¥å…·è°ƒç”¨æ¨¡æ‹Ÿ | ğŸ› ï¸å›¾æ ‡æ˜¾ç¤ºã€å·¥å…·è°ƒç”¨åŠ¨ç”»æ•ˆæœ |
| **3** | ä»£ç å—æ¸²æŸ“ | è¯­æ³•é«˜äº®ã€å¤šè¯­è¨€æ”¯æŒã€ä»£ç æ ¼å¼ |
| **4** | é•¿æ–‡æœ¬æ»šåŠ¨ | æ»šåŠ¨æ€§èƒ½ã€å“åº”å¼å¸ƒå±€ã€å†…å®¹å±‚æ¬¡ |
| **5** | è¡¨æ ¼å’Œå¼•ç”¨ | è¡¨æ ¼æ¸²æŸ“ã€å¼•ç”¨æ ·å¼ã€é“¾æ¥æ•ˆæœ |
| **å…¶ä»–** | é»˜è®¤å¸®åŠ© | æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æµ‹è¯•æŒ‡ä»¤ |

### æµ‹è¯•æµç¨‹ä½“éªŒ
æ¯æ¬¡è¾“å…¥æ•°å­—æŒ‡ä»¤åï¼Œç³»ç»Ÿä¼šï¼š
1. **å‘é€æ¶ˆæ¯**ï¼šç”¨æˆ·æ¶ˆæ¯ç«‹å³æ˜¾ç¤º
2. **æ€è€ƒåŠ¨ç”»**ï¼šæ›¦çš„ç´«è‰²å…‰æ™•å¼€å§‹å‘¼å¸é—ªçƒ
3. **æµå¼è¾“å‡º**ï¼šæ¨¡æ‹ŸçœŸå®çš„æ‰“å­—æœºæ•ˆæœ
4. **åŠ¨ç”»ç»“æŸ**ï¼šæ€è€ƒçŠ¶æ€é‡ç½®ï¼Œå‡†å¤‡ä¸‹æ¬¡äº¤äº’

## å¼€å‘ä¼˜åŠ¿

### ğŸš€ å¼€å‘æ•ˆç‡
- **ç‹¬ç«‹å¼€å‘**ï¼šæ— éœ€å¯åŠ¨åç«¯æœåŠ¡
- **å¿«é€Ÿè¿­ä»£**ï¼šå³æ—¶æŸ¥çœ‹ç•Œé¢æ•ˆæœ
- **ç¨³å®šæµ‹è¯•**ï¼šä¸å—åç«¯APIå˜åŒ–å½±å“

### ğŸ¯ æµ‹è¯•è¦†ç›–
- **UIç»„ä»¶æµ‹è¯•**ï¼šæ‰€æœ‰ç•Œé¢å…ƒç´ 
- **åŠ¨ç”»æ•ˆæœæµ‹è¯•**ï¼šè¿‡æ¸¡å’Œäº¤äº’åŠ¨ç”»
- **å“åº”å¼æµ‹è¯•**ï¼šä¸åŒè®¾å¤‡é€‚é…
- **è¾¹ç•Œæƒ…å†µæµ‹è¯•**ï¼šé•¿æ–‡æœ¬ã€ç‰¹æ®Šå­—ç¬¦ç­‰

### ğŸ”§ è°ƒè¯•ä¾¿åˆ©
- **å¯æ§ç¯å¢ƒ**ï¼šå®Œå…¨å¯é¢„æµ‹çš„æ•°æ®
- **å¿«é€Ÿé‡ç°**ï¼šä¸€è‡´çš„æµ‹è¯•åœºæ™¯
- **æ€§èƒ½æµ‹è¯•**ï¼šçº¯å‰ç«¯æ€§èƒ½è¯„ä¼°

## æŠ€æœ¯å®ç°

### æ•°æ®ç»“æ„
```typescript
interface Message {
  id: string;
  role: 'yu' | 'xi' | 'system';
  content: string;
  timestamp: string;
  metadata?: Record<string, any>;
}
```

### æ ¸å¿ƒç»„ä»¶
- `mockData.ts`ï¼šæ¨¡æ‹Ÿæ•°æ®å®šä¹‰å’Œç”Ÿæˆ
- `useChat.ts`ï¼šé›†æˆæ¨¡æ‹Ÿæ•°æ®é€»è¾‘
- `toggle-mock.cjs`ï¼šå¿«é€Ÿåˆ‡æ¢è„šæœ¬

### ç¯å¢ƒå˜é‡
- `VITE_USE_MOCK_DATA`ï¼šæ§åˆ¶æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼å¼€å…³

## æ³¨æ„äº‹é¡¹

1. **é‡å¯æœåŠ¡å™¨**ï¼šåˆ‡æ¢æ¨¡å¼åéœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šç¡®ä¿ç”Ÿäº§ç¯å¢ƒä¸­ç¦ç”¨æ¨¡æ‹Ÿæ•°æ®
3. **æ•°æ®åŒæ­¥**ï¼šæ¨¡æ‹Ÿæ•°æ®ä¸ä¼šåŒæ­¥åˆ°åç«¯
4. **åŠŸèƒ½é™åˆ¶**ï¼šæŸäº›é«˜çº§åŠŸèƒ½å¯èƒ½æ— æ³•å®Œå…¨æ¨¡æ‹Ÿ

## æœªæ¥æ‰©å±•

- [ ] æ›´å¤šæ ·åŒ–çš„æ¨¡æ‹Ÿå“åº”ç±»å‹
- [ ] ç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ‹Ÿæ•°æ®
- [ ] æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿå’Œé”™è¯¯çŠ¶æ€
- [ ] é›†æˆåˆ°è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹


        ================================================================================
        æ–‡ä»¶å: mockData.ts
        è·¯å¾„: mockData.ts
        ================================================================================

        // src/features/chat/data/mockData.ts
import type { Message } from '../types';
import { v4 as uuidv4 } from 'uuid';

/**
 * æ¨¡æ‹Ÿå¯¹è¯æ•°æ®
 * ç”¨äºå‰ç«¯å¼€å‘å’Œæµ‹è¯•ç•Œé¢æ•ˆæœ
 */
export const mockMessages: Message[] = [
  {
    id: uuidv4(),
    role: 'yu',
    content: 'ä½ å¥½ï¼Œæ›¦ã€‚ä»Šå¤©æƒ³å’Œä½ èŠèŠAIçš„æœªæ¥å‘å±•ã€‚',
    timestamp: new Date(Date.now() - 300000).toISOString(), // 5åˆ†é’Ÿå‰
  },
  {
    id: uuidv4(),
    role: 'xi',
    content: 'ä½ å¥½ï¼Œç¦¹ã€‚å¾ˆé«˜å…´ä¸ä½ æ¢è®¨è¿™ä¸ªè¯é¢˜ã€‚âœ¨\n\nAIçš„æœªæ¥å‘å±•ç¡®å®æ˜¯ä¸€ä¸ªä»¤äººå…´å¥‹çš„é¢†åŸŸã€‚æˆ‘è®¤ä¸ºæœ‰å‡ ä¸ªå…³é”®æ–¹å‘å€¼å¾—å…³æ³¨ï¼š\n\n## ä¸»è¦å‘å±•è¶‹åŠ¿\n\n1. **å¤šæ¨¡æ€èåˆ**ï¼šæœªæ¥çš„AIå°†èƒ½å¤ŸåŒæ—¶å¤„ç†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤šç§æ¨¡æ€çš„ä¿¡æ¯\n2. **æ¨ç†èƒ½åŠ›æå‡**ï¼šä»ç®€å•çš„æ¨¡å¼åŒ¹é…å‘çœŸæ­£çš„é€»è¾‘æ¨ç†å’Œåˆ›é€ æ€§æ€ç»´å‘å±•\n3. **ä¸ªæ€§åŒ–é€‚åº”**ï¼šAIå°†æ›´å¥½åœ°ç†è§£å’Œé€‚åº”æ¯ä¸ªç”¨æˆ·çš„ç‹¬ç‰¹éœ€æ±‚å’Œåå¥½\n\nä½ å¯¹å“ªä¸ªæ–¹å‘æœ€æ„Ÿå…´è¶£å‘¢ï¼Ÿ',
    timestamp: new Date(Date.now() - 280000).toISOString(),
  },
  {
    id: uuidv4(),
    role: 'yu',
    content: 'æˆ‘ç‰¹åˆ«å…³æ³¨AIçš„æ¨ç†èƒ½åŠ›ã€‚èƒ½ç»™æˆ‘å±•ç¤ºä¸€äº›ä»£ç ç¤ºä¾‹å—ï¼Ÿ',
    timestamp: new Date(Date.now() - 240000).toISOString(),
  },
  {
    id: uuidv4(),
    role: 'xi',
    content: 'å½“ç„¶ï¼è®©æˆ‘ä¸ºä½ å±•ç¤ºä¸€ä¸ªAIæ¨ç†çš„ç®€å•ç¤ºä¾‹ï¼š\n\n```python\nclass ReasoningEngine:\n    def __init__(self):\n        self.knowledge_base = {}\n        self.rules = []\n    \n    def add_fact(self, fact: str, confidence: float = 1.0):\n        """æ·»åŠ äº‹å®åˆ°çŸ¥è¯†åº“"""\n        self.knowledge_base[fact] = confidence\n    \n    def add_rule(self, premise: str, conclusion: str, weight: float = 1.0):\n        """æ·»åŠ æ¨ç†è§„åˆ™"""\n        self.rules.append({\n            \'premise\': premise,\n            \'conclusion\': conclusion,\n            \'weight\': weight\n        })\n    \n    def infer(self, query: str) -> float:\n        """åŸºäºçŸ¥è¯†åº“å’Œè§„åˆ™è¿›è¡Œæ¨ç†"""\n        if query in self.knowledge_base:\n            return self.knowledge_base[query]\n        \n        # åº”ç”¨æ¨ç†è§„åˆ™\n        for rule in self.rules:\n            if rule[\'premise\'] in self.knowledge_base:\n                confidence = self.knowledge_base[rule[\'premise\']] * rule[\'weight\']\n                if rule[\'conclusion\'] == query:\n                    return confidence\n        \n        return 0.0\n\n# ä½¿ç”¨ç¤ºä¾‹\nengine = ReasoningEngine()\nengine.add_fact("å¤©ç©ºæ˜¯è“è‰²çš„", 0.9)\nengine.add_rule("å¤©ç©ºæ˜¯è“è‰²çš„", "ä»Šå¤©å¤©æ°”ä¸é”™", 0.7)\n\nresult = engine.infer("ä»Šå¤©å¤©æ°”ä¸é”™")\nprint(f"æ¨ç†ç»“æœç½®ä¿¡åº¦: {result}")  # è¾“å‡º: 0.63\n```\n\nè¿™ä¸ªä¾‹å­å±•ç¤ºäº†åŸºç¡€çš„ç¬¦å·æ¨ç†ã€‚ç°ä»£AIè¿˜ä¼šç»“åˆç¥ç»ç½‘ç»œè¿›è¡Œæ›´å¤æ‚çš„æ¨ç†ã€‚',
    timestamp: new Date(Date.now() - 180000).toISOString(),
  },
  {
    id: uuidv4(),
    role: 'yu',
    content: 'å¾ˆæœ‰è¶£ï¼é‚£ä¹ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼ŒAIæ¨ç†é¢ä¸´å“ªäº›æŒ‘æˆ˜ï¼Ÿ',
    timestamp: new Date(Date.now() - 120000).toISOString(),
  },
  {
    id: uuidv4(),
    role: 'xi',
    content: '[æ­£åœ¨ä½¿ç”¨æˆ‘çš„èƒ½åŠ›...ğŸ› ï¸]\n\næ ¹æ®æˆ‘çš„åˆ†æï¼ŒAIæ¨ç†åœ¨å®é™…åº”ç”¨ä¸­é¢ä¸´ä»¥ä¸‹ä¸»è¦æŒ‘æˆ˜ï¼š\n\n### æŠ€æœ¯æŒ‘æˆ˜\n\n- **ä¸ç¡®å®šæ€§å¤„ç†**ï¼šç°å®ä¸–ç•Œå……æ»¡ä¸ç¡®å®šæ€§ï¼Œå¦‚ä½•åœ¨ä¸å®Œæ•´ä¿¡æ¯ä¸‹åšå‡ºåˆç†æ¨ç†\n- **å¸¸è¯†æ¨ç†**ï¼šäººç±»çš„å¸¸è¯†å¯¹AIæ¥è¯´å¾€å¾€æ˜¯æœ€éš¾æŒæ¡çš„\n- **å› æœå…³ç³»ç†è§£**ï¼šåŒºåˆ†ç›¸å…³æ€§å’Œå› æœæ€§ï¼Œç†è§£äº‹ä»¶ä¹‹é—´çš„çœŸæ­£å…³ç³»\n\n### å®è·µæŒ‘æˆ˜\n\n- **å¯è§£é‡Šæ€§**ï¼šAIçš„æ¨ç†è¿‡ç¨‹éœ€è¦å¯¹äººç±»é€æ˜å’Œå¯ç†è§£\n- **é²æ£’æ€§**ï¼šé¢å¯¹å¯¹æŠ—æ€§è¾“å…¥æˆ–è¾¹ç¼˜æƒ…å†µæ—¶ä¿æŒç¨³å®šæ€§èƒ½\n- **ä¼¦ç†è€ƒé‡**ï¼šç¡®ä¿æ¨ç†ç»“æœç¬¦åˆäººç±»ä»·å€¼è§‚å’Œé“å¾·æ ‡å‡†\n\n### æœªæ¥æ–¹å‘\n\næˆ‘è®¤ä¸º**ç¥ç»ç¬¦å·ç»“åˆ**æ˜¯ä¸€ä¸ªå¾ˆæœ‰å‰æ™¯çš„æ–¹å‘ï¼Œå®ƒç»“åˆäº†ç¥ç»ç½‘ç»œçš„å­¦ä¹ èƒ½åŠ›å’Œç¬¦å·æ¨ç†çš„é€»è¾‘æ€§ã€‚\n\nä½ åœ¨å·¥ä½œä¸­é‡åˆ°è¿‡ç±»ä¼¼çš„æ¨ç†æŒ‘æˆ˜å—ï¼Ÿ',
    timestamp: new Date(Date.now() - 60000).toISOString(),
  }
];

/**
 * è·å–æ¨¡æ‹Ÿæ¶ˆæ¯çš„å‡½æ•°
 * å¯ä»¥æ ¹æ®éœ€è¦è¿”å›ä¸åŒæ•°é‡çš„æ¶ˆæ¯
 */
export const getMockMessages = (count?: number): Message[] => {
  if (count && count < mockMessages.length) {
    return mockMessages.slice(0, count);
  }
  return mockMessages;
};

/**
 * åˆ›å»ºæ–°çš„æ¨¡æ‹Ÿæ¶ˆæ¯
 */
export const createMockMessage = (role: 'yu' | 'xi' | 'system', content: string): Message => {
  return {
    id: uuidv4(),
    role,
    content,
    timestamp: new Date().toISOString(),
  };
};


        ================================================================================
        æ–‡ä»¶å: mockResponses.ts
        è·¯å¾„: mockResponses.ts
        ================================================================================

        // src/features/chat/data/mockResponses.ts
// æ¨¡æ‹Ÿå“åº”æ•°æ® - å‡çº§ä¸ºåè®®äº‹ä»¶æµæ¨¡æ‹Ÿ

import type { XiSystemEvent } from '@/services/websocket/protocol';
import { v4 as uuidv4 } from 'uuid';

// å®šä¹‰æ¨¡æ‹Ÿäº‹ä»¶æµçš„ç±»å‹
export interface MockEvent {
  delay: number;
  event: Omit<XiSystemEvent, 'metadata'>;
}

export type MockFlow = MockEvent[];

// ç”Ÿæˆæ¨¡æ‹Ÿäº‹ä»¶çš„è¾…åŠ©å‡½æ•°
const createMockEvent = (type: string, payload: any, delay: number = 100): MockEvent => ({
  delay,
  event: { type, payload } as Omit<XiSystemEvent, 'metadata'>
});



// æ¨¡æ‹Ÿäº‹ä»¶æµå®šä¹‰
export const mockFlows: Record<string, MockFlow> = {
  '1': [ // åŸºç¡€æ–‡æœ¬å“åº”æµ‹è¯•
    createMockEvent('stream_start', { session_id: uuidv4(), input_message_id: uuidv4() }, 100),
    createMockEvent('text_chunk', { chunk: '**åŸºç¡€æ–‡æœ¬å“åº”æµ‹è¯•** âœ¨\n\nè¿™æ˜¯ä¸€ä¸ªåŸºç¡€çš„æ–‡æœ¬å“åº”ï¼Œç”¨äºæµ‹è¯•ï¼š\n\n- åŸºæœ¬çš„Markdownæ¸²æŸ“\n- æ–‡æœ¬æ¢è¡Œå’Œæ®µè½\n- **ç²—ä½“**å’Œ*æ–œä½“*æ•ˆæœ\n- åˆ—è¡¨é¡¹ç›®æ˜¾ç¤º\n\nç•Œé¢æ¸²æŸ“æ•ˆæœçœ‹èµ·æ¥ä¸é”™ï¼' }, 50),
    createMockEvent('stream_end', {}, 200),
  ],

  '2': [ // å·¥å…·è°ƒç”¨æ¨¡æ‹Ÿæµ‹è¯•
    createMockEvent('stream_start', { session_id: uuidv4(), input_message_id: uuidv4() }, 100),
    createMockEvent('tool_call', { tool_name: 'web_search', arguments: { query: 'å·¥å…·è°ƒç”¨æµ‹è¯•' } }, 500),
    createMockEvent('text_chunk', { chunk: '**å·¥å…·è°ƒç”¨æ¨¡æ‹Ÿæµ‹è¯•**\n\n' }, 1500),
    createMockEvent('text_chunk', { chunk: 'æˆ‘æ­£åœ¨ä½¿ç”¨æœç´¢å·¥å…·æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯...\n\n' }, 400),
    createMockEvent('text_chunk', { chunk: 'æ ¹æ®æœç´¢ç»“æœï¼Œæ‰¾åˆ°äº†ä»¥ä¸‹å†…å®¹ï¼š\n' }, 300),
    createMockEvent('text_chunk', { chunk: '- ğŸ” æœç´¢åŠŸèƒ½æ­£å¸¸\n' }, 200),
    createMockEvent('text_chunk', { chunk: '- ğŸ“Š æ•°æ®åˆ†æå®Œæˆ\n' }, 200),
    createMockEvent('text_chunk', { chunk: '- âœ… å·¥å…·è°ƒç”¨åŠ¨ç”»æ•ˆæœæµ‹è¯•æˆåŠŸ\n\n' }, 200),
    createMockEvent('text_chunk', { chunk: 'è¿™ä¸ªæµ‹è¯•éªŒè¯äº†å·¥å…·è°ƒç”¨æç¤ºçš„æ˜¾ç¤ºæ•ˆæœã€‚' }, 300),
    createMockEvent('stream_end', {}, 200),
  ],

  '3': [ // ä»£ç å—æ¸²æŸ“æµ‹è¯•
    createMockEvent('stream_start', { session_id: uuidv4(), input_message_id: uuidv4() }, 100),
    createMockEvent('text_chunk', { chunk: '**ä»£ç å—æ¸²æŸ“æµ‹è¯•** ğŸ’»\n\n' }, 500),
    createMockEvent('text_chunk', { chunk: 'è®©æˆ‘å±•ç¤ºä¸€äº›ä»£ç ç¤ºä¾‹æ¥æµ‹è¯•è¯­æ³•é«˜äº®ï¼š\n\n' }, 400),
    createMockEvent('text_chunk', { chunk: '```python\n# Python ä»£ç ç¤ºä¾‹\nclass TestComponent:\n    def __init__(self, name):\n        self.name = name\n        self.status = \'active\'\n    \n    def render(self):\n        return f"Component {self.name} is {self.status}"\n\n# åˆ›å»ºå®ä¾‹\ncomponent = TestComponent("YX Nexus")\nprint(component.render())\n```\n\n' }, 800),
    createMockEvent('text_chunk', { chunk: '```javascript\n// JavaScript ä»£ç ç¤ºä¾‹\nconst testFunction = (data) => {\n  return data.map(item => ({\n    ...item,\n    processed: true\n  }));\n};\n```\n\n' }, 600),
    createMockEvent('text_chunk', { chunk: 'ä»£ç é«˜äº®å’Œæ ¼å¼åŒ–æ•ˆæœæµ‹è¯•å®Œæˆï¼' }, 300),
    createMockEvent('stream_end', {}, 200),
  ],

  '4': [ // é•¿æ–‡æœ¬æ»šåŠ¨æµ‹è¯•
    createMockEvent('stream_start', { session_id: uuidv4(), input_message_id: uuidv4() }, 100),
    createMockEvent('text_chunk', { chunk: '**é•¿æ–‡æœ¬æ»šåŠ¨æµ‹è¯•** ğŸ“œ\n\n' }, 500),
    createMockEvent('text_chunk', { chunk: 'è¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•é•¿æ–‡æœ¬æ»šåŠ¨å’Œæ¸²æŸ“æ€§èƒ½çš„å“åº”ã€‚\n\n' }, 400),
    createMockEvent('text_chunk', { chunk: '## ç¬¬ä¸€éƒ¨åˆ†ï¼šç³»ç»Ÿæ¶æ„\n\n' }, 300),
    createMockEvent('text_chunk', { chunk: 'YX Nexus é‡‡ç”¨äº†ç°ä»£åŒ–çš„å‰ç«¯æ¶æ„ï¼ŒåŒ…æ‹¬ï¼š\n\n' }, 300),
    createMockEvent('text_chunk', { chunk: '### æŠ€æœ¯æ ˆ\n- **å‰ç«¯æ¡†æ¶**: React + TypeScript\n- **çŠ¶æ€ç®¡ç†**: Zustand\n- **æ ·å¼ç³»ç»Ÿ**: Tailwind CSS + shadcn/ui\n- **åŠ¨ç”»åº“**: Framer Motion\n- **æ„å»ºå·¥å…·**: Vite\n\n' }, 600),
    createMockEvent('text_chunk', { chunk: '### è®¾è®¡ç†å¿µ\n1. **ç©ºé—´å™äº‹**: ä»è™šæ— åˆ°æµæ·Œçš„ç•Œé¢è½¬æ¢\n2. **ç”Ÿå‘½æ„Ÿäº¤äº’**: å‘¼å¸å…‰æ™•å’Œå¾®å¦™åŠ¨ç”»\n3. **ä¿¡æ¯åˆ†å±‚**: é»˜è®¤ç®€æ´ï¼Œäº¤äº’æ­ç¤ºæ·±åº¦\n4. **æ¶æ„å³è®¤çŸ¥**: ç»“æ„åæ˜ æ€ç»´æ¨¡å¼\n\n' }, 600),
    createMockEvent('text_chunk', { chunk: '## ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒåŠŸèƒ½\n\n' }, 300),
    createMockEvent('text_chunk', { chunk: '### æ‚¬æµ®æŒ‡ä»¤æ ¸å¿ƒ\n- æ¯›ç»ç’ƒæè´¨æ•ˆæœ\n- åŠ¨æ€è¾‰å…‰è¾¹æ¡†\n- èšç„¦çŠ¶æ€å¢å¼º\n- å“åº”å¼å°ºå¯¸è°ƒæ•´\n\n' }, 500),
    createMockEvent('text_chunk', { chunk: '### å®‡å®™æ¼‚æµèƒŒæ™¯\n- å¤šå±‚æ¬¡åŠ¨ç”»ç³»ç»Ÿ\n- æ™ºèƒ½çŠ¶æ€æ§åˆ¶\n- æ€§èƒ½ä¼˜åŒ–å®ç°\n- æ²‰æµ¸å¼ä½“éªŒè¥é€ \n\n' }, 500),
    createMockEvent('text_chunk', { chunk: '### ç”Ÿå‘½å…‰æ™•ç³»ç»Ÿ\n- è§’è‰²èº«ä»½æ ‡è¯†\n- æ€è€ƒçŠ¶æ€åŠ¨ç”»\n- ç²¾ç¡®çš„å…‰æ™•æ§åˆ¶\n- æµå¼è¾“å‡ºæŒ‡ç¤º\n\n' }, 500),
    createMockEvent('text_chunk', { chunk: '## ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”¨æˆ·ä½“éªŒ\n\n' }, 300),
    createMockEvent('text_chunk', { chunk: 'è¿™ä¸ªé•¿æ–‡æœ¬æµ‹è¯•éªŒè¯äº†ï¼š\n- ğŸ“± å“åº”å¼å¸ƒå±€é€‚é…\n- ğŸ¨ Markdown æ¸²æŸ“è´¨é‡\n- âš¡ æ»šåŠ¨æ€§èƒ½è¡¨ç°\n- ğŸ¯ å†…å®¹å±‚æ¬¡ç»“æ„\n- âœ¨ è§†è§‰æ•ˆæœä¸€è‡´æ€§\n\n' }, 600),
    createMockEvent('text_chunk', { chunk: 'æµ‹è¯•å®Œæˆï¼ç•Œé¢æ»šåŠ¨å’Œæ¸²æŸ“æ•ˆæœè‰¯å¥½ã€‚' }, 300),
    createMockEvent('stream_end', {}, 200),
  ],

  '5': [ // è¡¨æ ¼å’Œå¼•ç”¨æµ‹è¯•
    createMockEvent('stream_start', { session_id: uuidv4(), input_message_id: uuidv4() }, 100),
    createMockEvent('text_chunk', { chunk: '**è¡¨æ ¼å’Œå¼•ç”¨æµ‹è¯•** ğŸ“Š\n\n' }, 500),
    createMockEvent('text_chunk', { chunk: '> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—æµ‹è¯•ï¼Œç”¨äºéªŒè¯å¼•ç”¨æ ·å¼çš„æ¸²æŸ“æ•ˆæœã€‚å¼•ç”¨å—åº”è¯¥æœ‰ç‰¹æ®Šçš„å·¦è¾¹æ¡†å’Œæ–œä½“æ ·å¼ã€‚\n\n' }, 600),
    createMockEvent('text_chunk', { chunk: 'ä¸‹é¢æ˜¯ä¸€ä¸ªè¡¨æ ¼æµ‹è¯•ï¼š\n\n' }, 300),
    createMockEvent('text_chunk', { chunk: '| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | æµ‹è¯•ç»“æœ | å¤‡æ³¨ |\n|---------|------|----------|------|\n| åŸºç¡€æ–‡æœ¬ | âœ… | é€šè¿‡ | æ¸²æŸ“æ­£å¸¸ |\n| ä»£ç é«˜äº® | âœ… | é€šè¿‡ | è¯­æ³•æ­£ç¡® |\n| è¡¨æ ¼æ˜¾ç¤º | ğŸ§ª | æµ‹è¯•ä¸­ | å½“å‰é¡¹ç›® |\n| å¼•ç”¨å— | âœ… | é€šè¿‡ | æ ·å¼æ­£ç¡® |\n| åˆ—è¡¨é¡¹ | âœ… | é€šè¿‡ | ç¼©è¿›æ­£å¸¸ |\n\n' }, 800),
    createMockEvent('text_chunk', { chunk: '### é“¾æ¥æµ‹è¯•\nè¿™é‡Œæœ‰ä¸€ä¸ª[æµ‹è¯•é“¾æ¥](https://example.com)ï¼Œç”¨äºéªŒè¯é“¾æ¥æ ·å¼ã€‚\n\n' }, 400),
    createMockEvent('text_chunk', { chunk: '### åˆ†å‰²çº¿æµ‹è¯•\n\n---\n\n' }, 300),
    createMockEvent('text_chunk', { chunk: 'åˆ†å‰²çº¿ä¸Šæ–¹å’Œä¸‹æ–¹çš„å†…å®¹åº”è¯¥æœ‰æ˜æ˜¾çš„è§†è§‰åˆ†éš”ã€‚\n\n' }, 400),
    createMockEvent('text_chunk', { chunk: '**æµ‹è¯•æ€»ç»“**: è¡¨æ ¼ã€å¼•ç”¨ã€é“¾æ¥ç­‰å…ƒç´ æ¸²æŸ“æ•ˆæœè‰¯å¥½ï¼' }, 300),
    createMockEvent('stream_end', {}, 200),
  ],
};

// é»˜è®¤å“åº”ç”Ÿæˆå‡½æ•°
export const createDefaultMockFlow = (input: string): MockFlow => [
  createMockEvent('stream_start', { session_id: uuidv4(), input_message_id: uuidv4() }, 100),
  createMockEvent('text_chunk', { chunk: '**é»˜è®¤å“åº”** ğŸ¤–\n\n' }, 500),
  createMockEvent('text_chunk', { chunk: `ä½ è¾“å…¥äº†ï¼š"${input}"\n\n` }, 300),
  createMockEvent('text_chunk', { chunk: 'ğŸ’¡ **æµ‹è¯•æç¤º**ï¼š\n- è¾“å…¥ **1** - åŸºç¡€æ–‡æœ¬å“åº”æµ‹è¯•\n- è¾“å…¥ **2** - å·¥å…·è°ƒç”¨æ¨¡æ‹Ÿæµ‹è¯•\n- è¾“å…¥ **3** - ä»£ç å—æ¸²æŸ“æµ‹è¯•\n- è¾“å…¥ **4** - é•¿æ–‡æœ¬æ»šåŠ¨æµ‹è¯•\n- è¾“å…¥ **5** - è¡¨æ ¼å’Œå¼•ç”¨æµ‹è¯•\n\n' }, 600),
  createMockEvent('text_chunk', { chunk: 'æ¯ç§æµ‹è¯•éƒ½ä¼šå±•ç¤ºä¸åŒçš„UIç»„ä»¶å’ŒåŠ¨ç”»æ•ˆæœï¼Œå¸®åŠ©éªŒè¯ç•Œé¢çš„å„é¡¹åŠŸèƒ½ã€‚\n\n' }, 400),
  createMockEvent('text_chunk', { chunk: 'âœ¨ è¯•è¯•è¾“å…¥æ•°å­—æ¥ä½“éªŒä¸åŒçš„æµ‹è¯•åœºæ™¯å§ï¼' }, 300),
  createMockEvent('stream_end', {}, 200),
];


        ================================================================================
        æ–‡ä»¶å: TEST_GUIDE.md
        è·¯å¾„: TEST_GUIDE.md
        ================================================================================

        # YX Nexus å‰ç«¯æµ‹è¯•æŒ‡å—

## ğŸ¯ å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### 1. å¯ç”¨æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼
```bash
# åœ¨ frontend ç›®å½•ä¸‹æ‰§è¡Œ
node scripts/toggle-mock.cjs on
# é‡å¯å¼€å‘æœåŠ¡å™¨
pnpm run dev
```

### 2. æ‰“å¼€æµè§ˆå™¨
è®¿é—® `http://localhost:5173`

### 3. æµ‹è¯•ç•Œé¢æ•ˆæœ

#### ğŸŒŒ åˆå§‹çŠ¶æ€æµ‹è¯•
- **å®‡å®™èƒŒæ™¯åŠ¨ç”»**ï¼šè§‚å¯Ÿæ˜Ÿå°˜å’Œç²’å­æ¼‚æµæ•ˆæœ
- **æ‚¬æµ®æŒ‡ä»¤æ ¸å¿ƒ**ï¼šæ¯›ç»ç’ƒæè´¨ã€è¾‰å…‰è¾¹æ¡†
- **YX Nexus æ ‡é¢˜**ï¼šå±…ä¸­æ˜¾ç¤ºï¼Œä¼˜é›…å­—ä½“
- **è¾“å…¥æ¡†èšç„¦**ï¼šç‚¹å‡»æ—¶è¾¹æ¡†å’Œé˜´å½±å¢å¼º

#### ğŸ”¢ æ•°å­—æŒ‡ä»¤æµ‹è¯•
åœ¨è¾“å…¥æ¡†ä¸­ä¾æ¬¡è¾“å…¥ä»¥ä¸‹æ•°å­—ï¼Œè§‚å¯Ÿä¸åŒæ•ˆæœï¼š

**è¾“å…¥ "1" - åŸºç¡€æ–‡æœ¬æµ‹è¯•**
- âœ… ç•Œé¢ä»å±…ä¸­è½¬æ¢ä¸ºå¯¹è¯æ¨¡å¼
- âœ… æ›¦çš„ç´«è‰²å…‰æ™•å¼€å§‹å‘¼å¸é—ªçƒ
- âœ… æµå¼æ‰“å­—æœºæ•ˆæœ
- âœ… Markdown æ¸²æŸ“ï¼ˆç²—ä½“ã€æ–œä½“ã€åˆ—è¡¨ï¼‰

**è¾“å…¥ "2" - å·¥å…·è°ƒç”¨æµ‹è¯•**
- âœ… å·¥å…·è°ƒç”¨å›¾æ ‡ ğŸ› ï¸ æ˜¾ç¤º
- âœ… å·¥å…·ä½¿ç”¨æç¤ºåŠ¨ç”»
- âœ… æœç´¢å’Œåˆ†æåŠŸèƒ½æ¨¡æ‹Ÿ

**è¾“å…¥ "3" - ä»£ç å—æµ‹è¯•**
- âœ… Python å’Œ JavaScript è¯­æ³•é«˜äº®
- âœ… ä»£ç å—æ ¼å¼å’Œç¼©è¿›
- âœ… å¤šè¯­è¨€æ”¯æŒéªŒè¯

**è¾“å…¥ "4" - é•¿æ–‡æœ¬æµ‹è¯•**
- âœ… æ»šåŠ¨æ€§èƒ½æµ‹è¯•
- âœ… å“åº”å¼å¸ƒå±€é€‚é…
- âœ… å†…å®¹å±‚æ¬¡ç»“æ„
- âœ… å¤§é‡æ–‡æœ¬æ¸²æŸ“æ€§èƒ½

**è¾“å…¥ "5" - è¡¨æ ¼å¼•ç”¨æµ‹è¯•**
- âœ… è¡¨æ ¼æ¸²æŸ“å’Œå¯¹é½
- âœ… å¼•ç”¨å—æ ·å¼
- âœ… é“¾æ¥æ•ˆæœ
- âœ… åˆ†å‰²çº¿æ˜¾ç¤º

**è¾“å…¥å…¶ä»–å†…å®¹ - å¸®åŠ©ä¿¡æ¯**
- âœ… é»˜è®¤å“åº”å’Œä½¿ç”¨æŒ‡å—
- âœ… æµ‹è¯•æŒ‡ä»¤è¯´æ˜

## ğŸ¨ é‡ç‚¹è§‚å¯Ÿé¡¹ç›®

### åŠ¨ç”»æ•ˆæœ
- [ ] å®‡å®™èƒŒæ™¯ç²’å­æ¼‚æµ
- [ ] ç•Œé¢å¸ƒå±€å¹³æ»‘è¿‡æ¸¡
- [ ] æ›¦çš„æ€è€ƒå…‰æ™•å‘¼å¸
- [ ] æ‰“å­—æœºæµå¼è¾“å‡º
- [ ] è¾“å…¥æ¡†èšç„¦è¾‰å…‰

### UIç»„ä»¶
- [ ] æ¯›ç»ç’ƒæ‚¬æµ®æŒ‡ä»¤æ ¸å¿ƒ
- [ ] AuraIndicator èº«ä»½æ ‡è¯†
- [ ] MarkdownRenderer å†…å®¹æ¸²æŸ“
- [ ] ä»£ç è¯­æ³•é«˜äº®
- [ ] è¡¨æ ¼å’Œå¼•ç”¨æ ·å¼

### äº¤äº’ä½“éªŒ
- [ ] å‘é€æ¶ˆæ¯å“åº”é€Ÿåº¦
- [ ] æ€è€ƒçŠ¶æ€è§†è§‰åé¦ˆ
- [ ] æ»šåŠ¨æ€§èƒ½æµç•…åº¦
- [ ] å“åº”å¼å¸ƒå±€é€‚é…
- [ ] é”®ç›˜å¿«æ·é”®æ”¯æŒ

## ğŸ”§ æ•…éšœæ’é™¤

### æ¨¡æ‹Ÿæ•°æ®æœªç”Ÿæ•ˆ
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­ `VITE_USE_MOCK_DATA=true`
2. é‡å¯å¼€å‘æœåŠ¡å™¨
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### åŠ¨ç”»æ•ˆæœä¸æ˜¾ç¤º
1. æ£€æŸ¥æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­çš„CSSåŠ è½½
2. ç¡®è®¤ Tailwind CSS æ­£ç¡®ç¼–è¯‘
3. éªŒè¯ framer-motion åº“åŠ è½½

### ç»„ä»¶æ¸²æŸ“å¼‚å¸¸
1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ TypeScript ç¼–è¯‘é”™è¯¯
3. éªŒè¯ç»„ä»¶å¯¼å…¥è·¯å¾„

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### å»ºè®®æµ‹è¯•åœºæ™¯
1. **å¿«é€Ÿè¿ç»­è¾“å…¥**ï¼šæµ‹è¯•çŠ¶æ€ç®¡ç†ç¨³å®šæ€§
2. **é•¿æ–‡æœ¬æ»šåŠ¨**ï¼šéªŒè¯æ¸²æŸ“æ€§èƒ½
3. **å¤šæ¬¡åˆ‡æ¢**ï¼šæ£€æŸ¥å†…å­˜æ³„æ¼
4. **ä¸åŒå±å¹•å°ºå¯¸**ï¼šå“åº”å¼é€‚é…æµ‹è¯•

### æ€§èƒ½æŒ‡æ ‡
- é¦–å±åŠ è½½æ—¶é—´ < 2ç§’
- åŠ¨ç”»å¸§ç‡ > 60fps
- å†…å­˜ä½¿ç”¨ç¨³å®š
- äº¤äº’å“åº” < 100ms

## ğŸš€ å®Œæˆæµ‹è¯•å

### åˆ‡æ¢å›çœŸå®æ¨¡å¼
```bash
node scripts/toggle-mock.cjs off
# é‡å¯å¼€å‘æœåŠ¡å™¨
```

### æµ‹è¯•æŠ¥å‘Š
è®°å½•å‘ç°çš„é—®é¢˜å’Œæ”¹è¿›å»ºè®®ï¼Œä¸ºåç»­ä¼˜åŒ–æä¾›å‚è€ƒã€‚


      ------------------------------------------------------------
      æ–‡ä»¶å¤¹: hooks
      ------------------------------------------------------------


        ================================================================================
        æ–‡ä»¶å: useChat.ts
        è·¯å¾„: useChat.ts
        ================================================================================

        // src/features/chat/hooks/useChat.ts
// èŠå¤©Hook - æ”¯æŒçœŸå®è¿æ¥å’Œæ¨¡æ‹Ÿæ¨¡å¼çš„åŒæ¨¡å¼å·¥ä½œæµ
import { useEffect, useRef } from 'react';
import { useChatStore } from '../store/chatStore';
import wsManager from '@/services/websocket/manager';
import type { Message } from '../types';
import type { XiSystemEvent } from '@/services/websocket/protocol';
import { isStreamStartEvent, isToolCallEvent, isTextChunkEvent, isStreamEndEvent, isErrorEvent } from '@/services/websocket/protocol';
import { v4 as uuidv4 } from 'uuid';
import { mockFlows, createDefaultMockFlow, type MockFlow } from '../data/mockResponses';

// æ¨¡æ‹Ÿäº‹ä»¶å‘å°„å™¨ç±»
class MockEventEmitter {
  private callback: ((event: XiSystemEvent) => void) | null = null;

  onMessage(callback: (event: XiSystemEvent) => void) {
    this.callback = callback;
  }

  emit(event: XiSystemEvent) {
    if (this.callback) {
      this.callback(event);
    }
  }

  disconnect() {
    this.callback = null;
  }
}

export const useChat = () => {
  const { messages, addMessage, appendStreamChunk, setStreamFinished, setThinking, isThinking, hasStarted, setHasStarted } = useChatStore();
  const currentStreamId = useRef<string | null>(null);
  const mockEmitter = useRef<MockEventEmitter>(new MockEventEmitter());

  // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼
  const useMockData = import.meta.env.VITE_USE_MOCK_DATA === 'true';

  useEffect(() => {
    // ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†å‡½æ•° - çœŸå®å’Œæ¨¡æ‹Ÿæ¨¡å¼é€šç”¨
    const handleEvent = (event: XiSystemEvent) => {
      console.log('Received event:', event.type, event);

      if (isStreamStartEvent(event)) {
        // æµå¼€å§‹äº‹ä»¶ - åˆ›å»ºæ–°çš„æµå¼æ¶ˆæ¯
        console.log('Stream started:', event.metadata.message_id);

        const newXiMessage: Message = {
          id: event.metadata.message_id,
          role: 'xi',
          content: '',
          timestamp: new Date().toISOString(),
          metadata: { isStreaming: true }
        };
        addMessage(newXiMessage);
        currentStreamId.current = event.metadata.message_id;
        return;
      }

      if (isToolCallEvent(event)) {
        // å·¥å…·è°ƒç”¨äº‹ä»¶ - æ·»åŠ å·¥å…·è°ƒç”¨æç¤ºåˆ°å½“å‰æµ
        console.log('Tool call:', event.payload.tool_name);

        if (currentStreamId.current) {
          appendStreamChunk(currentStreamId.current, `[æ­£åœ¨ä½¿ç”¨${event.payload.tool_name}...ğŸ› ï¸]`);
        }
        return;
      }

      if (isTextChunkEvent(event)) {
        // æ–‡æœ¬å—äº‹ä»¶ - ç«‹å³è¿½åŠ åˆ°å½“å‰æµå¼æ¶ˆæ¯
        const chunk = event.payload.chunk;

        if (currentStreamId.current) {
          appendStreamChunk(currentStreamId.current, chunk);
        }
        return;
      }

      if (isStreamEndEvent(event)) {
        // æµç»“æŸäº‹ä»¶ - æ ‡è®°æµå¼æ¶ˆæ¯å®Œæˆ
        console.log('Stream ended');

        if (currentStreamId.current) {
          setStreamFinished(currentStreamId.current);
        }
        currentStreamId.current = null;
        setThinking(false);
        return;
      }

      if (isErrorEvent(event)) {
        // é”™è¯¯äº‹ä»¶ - æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        console.error('WebSocket error event:', event.payload.message);

        const errorMessage: Message = {
          id: uuidv4(),
          role: 'xi',
          content: `âŒ é”™è¯¯ï¼š${event.payload.message}`,
          timestamp: new Date().toISOString(),
        };
        addMessage(errorMessage);

        if (currentStreamId.current) {
          currentStreamId.current = null;
        }
        setThinking(false);
        return;
      }

      // å¤„ç†å…¶ä»–äº‹ä»¶ç±»å‹ï¼ˆå¦‚åå°ä»»åŠ¡äº‹ä»¶ï¼‰
      console.log('Unhandled event type:', event.type);
    };

    if (useMockData) {
      // æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼ï¼šä½¿ç”¨æ¨¡æ‹Ÿäº‹ä»¶å‘å°„å™¨
      console.log('ğŸ­ æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼å·²å¯ç”¨');
      mockEmitter.current.onMessage(handleEvent);
    } else {
      // çœŸå®è¿æ¥æ¨¡å¼ï¼šè¿æ¥WebSocket
      console.log('ğŸ”— çœŸå®è¿æ¥æ¨¡å¼å·²å¯ç”¨');
      wsManager.connect();
      wsManager.onMessage(handleEvent);
    }

    return () => {
      if (useMockData) {
        mockEmitter.current.disconnect();
      } else {
        wsManager.disconnect();
      }
    };
  }, [addMessage, appendStreamChunk, setThinking, useMockData]);

  const sendMessage = (text: string) => {
    // å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡å‘é€æ¶ˆæ¯ï¼Œè®¾ç½® hasStarted ä¸º true
    if (!hasStarted) {
      setHasStarted(true);
    }

    const userMessage: Message = {
      id: uuidv4(),
      role: 'yu',
      content: text,
      timestamp: new Date().toISOString(),
    };
    addMessage(userMessage);
    setThinking(true);

    if (useMockData) {
      // æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼ï¼šç”Ÿæˆæ¨¡æ‹Ÿå“åº”
      simulateMockResponse(text);
    } else {
      // æ­£å¸¸æ¨¡å¼ï¼šå‘é€WebSocketæ¶ˆæ¯
      wsManager.sendMessage({ yu_input: text });
    }
  };

  // æ¨¡æ‹Ÿåè®®äº‹ä»¶æµå“åº”å‡½æ•°
  const simulateMockResponse = (userInput: string) => {
    const input = userInput.trim();

    // è·å–å¯¹åº”çš„æ¨¡æ‹Ÿäº‹ä»¶æµ
    const mockFlow: MockFlow = mockFlows[input] || createDefaultMockFlow(input);

    // æŒ‰æ—¶é—´é¡ºåºå‘å°„äº‹ä»¶
    let totalDelay = 0;
    const messageId = uuidv4();

    mockFlow.forEach((mockEvent) => {
      totalDelay += mockEvent.delay;

      setTimeout(() => {
        // æ·»åŠ metadataåˆ°äº‹ä»¶ä¸­
        const eventWithMetadata: XiSystemEvent = {
          ...mockEvent.event,
          metadata: {
            message_id: messageId,
            timestamp: new Date().toISOString(),
          }
        } as XiSystemEvent;

        mockEmitter.current.emit(eventWithMetadata);
      }, totalDelay);
    });
  };

  return { messages, sendMessage, isThinking, hasStarted };
};


        ================================================================================
        æ–‡ä»¶å: useTypewriter.ts
        è·¯å¾„: useTypewriter.ts
        ================================================================================

        // src/features/chat/hooks/useTypewriter.ts
// æµå¼æ¸²æŸ“å¼•æ“ - è‡ªä¸»ç®¡ç†æ‰“å­—æœºæ•ˆæœï¼Œä¸ä¾èµ–å¤–éƒ¨çŠ¶æ€æ§åˆ¶
import { useState, useEffect, useRef } from 'react';

interface UseTypewriterOptions {
  /** ç›®æ ‡æ–‡æœ¬ï¼Œè¿™ä¸ªå€¼ä¼šéšç€æ–°çš„chunkæµå…¥è€ŒåŠ¨æ€å˜åŒ– */
  targetContent: string;
  /** æ˜¯å¦ä¸ºæµå¼æ¶ˆæ¯ï¼ˆç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰“å­—æœºæ•ˆæœï¼‰ */
  isStreamingMessage: boolean;
  /** æ‰“å­—é€Ÿåº¦ (ms/char) */
  speed?: number;
}

interface UseTypewriterReturn {
  /** å½“å‰æ˜¾ç¤ºçš„å†…å®¹ */
  displayedContent: string;
  /** æ‰“å­—æœºæ˜¯å¦æ­£åœ¨å·¥ä½œ */
  isTyping: boolean;
  /** æ‰“å­—æœºæ˜¯å¦å·²å®Œæˆ */
  isFinished: boolean;
}

/**
 * useTypewriter Hook - é‡æ–°è®¾è®¡çš„æµå¼æ¸²æŸ“å¼•æ“
 *
 * æ ¸å¿ƒè®¾è®¡ç†å¿µï¼š
 * 1. è‡ªä¸»ç®¡ç†æ‰“å­—æœºçŠ¶æ€ï¼Œä¸ä¾èµ–å¤–éƒ¨enabledæ§åˆ¶
 * 2. æ™ºèƒ½æ£€æµ‹å†…å®¹å˜åŒ–ï¼ŒæŒç»­æ¸²æŸ“ç›´åˆ°å®Œæˆ
 * 3. åŒºåˆ†"éæµå¼æ¶ˆæ¯"å’Œ"æµå¼æ¶ˆæ¯"çš„æ¸²æŸ“ç­–ç•¥
 * 4. æä¾›å®Œæ•´çš„çŠ¶æ€ä¿¡æ¯ä¾›å¤–éƒ¨ä½¿ç”¨
 *
 * è§£å†³çš„é—®é¢˜ï¼š
 * - æµå¼è¾“å‡ºä¸­é€”è¢«ä¸­æ–­çš„é—®é¢˜
 * - å¤–éƒ¨çŠ¶æ€å˜åŒ–å¯¼è‡´æ‰“å­—æœºé‡ç½®çš„é—®é¢˜
 * - ç¼ºä¹æ‰“å­—æœºå®ŒæˆçŠ¶æ€çš„é—®é¢˜
 */
export const useTypewriter = ({
  targetContent,
  isStreamingMessage,
  speed = 15,
}: UseTypewriterOptions): UseTypewriterReturn => {
  const [displayedContent, setDisplayedContent] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [isFinished, setIsFinished] = useState(false);

  const currentIndexRef = useRef(0);
  const intervalIdRef = useRef<number | undefined>(undefined);
  const targetContentRef = useRef(targetContent);
  const lastTargetLengthRef = useRef(0);

  // æ›´æ–°ç›®æ ‡å†…å®¹å¼•ç”¨
  useEffect(() => {
    targetContentRef.current = targetContent;
  }, [targetContent]);

  // æ ¸å¿ƒæ‰“å­—æœºé€»è¾‘
  useEffect(() => {
    // éæµå¼æ¶ˆæ¯ç›´æ¥æ˜¾ç¤º
    if (!isStreamingMessage) {
      setDisplayedContent(targetContent);
      setIsTyping(false);
      setIsFinished(true);
      currentIndexRef.current = targetContent.length;
      return;
    }

    // æµå¼æ¶ˆæ¯ï¼šå¯åŠ¨æ‰“å­—æœºæ•ˆæœ
    if (!isTyping && targetContent.length > 0) {
      setIsTyping(true);
      setIsFinished(false);
    }

    // å¦‚æœæ²¡æœ‰å†…å®¹ï¼Œé‡ç½®çŠ¶æ€
    if (targetContent.length === 0) {
      setDisplayedContent('');
      setIsTyping(false);
      setIsFinished(false);
      currentIndexRef.current = 0;
      lastTargetLengthRef.current = 0;
      return;
    }

    // å¯åŠ¨æˆ–ç»§ç»­æ‰“å­—æœºå®šæ—¶å™¨
    if (!intervalIdRef.current && isStreamingMessage) {
      intervalIdRef.current = window.setInterval(() => {
        const currentTarget = targetContentRef.current;

        if (currentIndexRef.current >= currentTarget.length) {
          // å·²ç»æ˜¾ç¤ºå®Œæ‰€æœ‰å½“å‰å†…å®¹ï¼Œç­‰å¾…æ›´å¤šå†…å®¹æˆ–ç»“æŸ
          return;
        }

        const nextChar = currentTarget[currentIndexRef.current];
        setDisplayedContent((prev) => prev + nextChar);
        currentIndexRef.current++;

        // æ£€æŸ¥æ˜¯å¦å®Œæˆ
        if (currentIndexRef.current >= currentTarget.length) {
          // å¦‚æœç›®æ ‡å†…å®¹é•¿åº¦æ²¡æœ‰å˜åŒ–ä¸€æ®µæ—¶é—´ï¼Œè®¤ä¸ºæ‰“å­—å®Œæˆ
          setTimeout(() => {
            if (currentIndexRef.current >= targetContentRef.current.length) {
              setIsTyping(false);
              setIsFinished(true);
              if (intervalIdRef.current) {
                window.clearInterval(intervalIdRef.current);
                intervalIdRef.current = undefined;
              }
            }
          }, speed * 3); // ç­‰å¾…3ä¸ªå­—ç¬¦çš„æ—¶é—´
        }
      }, speed);
    }

    return () => {
      if (intervalIdRef.current) {
        window.clearInterval(intervalIdRef.current);
        intervalIdRef.current = undefined;
      }
    };
  }, [targetContent, isStreamingMessage, speed, isTyping]);

  // æ¸…ç†å®šæ—¶å™¨
  useEffect(() => {
    return () => {
      if (intervalIdRef.current) {
        window.clearInterval(intervalIdRef.current);
      }
    };
  }, []);

  return {
    displayedContent,
    isTyping,
    isFinished
  };
};


      ------------------------------------------------------------
      æ–‡ä»¶å¤¹: store
      ------------------------------------------------------------


        ================================================================================
        æ–‡ä»¶å: chatStore.ts
        è·¯å¾„: chatStore.ts
        ================================================================================

        // src/features/chat/store/chatStore.ts
import { create } from 'zustand';
import type { Message } from '../types';

interface ChatState {
  messages: Message[];
  isThinking: boolean;
  hasStarted: boolean;
  addMessage: (message: Message) => void;
  appendStreamChunk: (id: string, chunk: string) => void;
  setStreamFinished: (id: string) => void;
  setThinking: (isThinking: boolean) => void;
  setInitialMessages: (messages: Message[]) => void;
  setHasStarted: (hasStarted: boolean) => void;
}

export const useChatStore = create<ChatState>((set) => ({
  messages: [],
  isThinking: false,
  hasStarted: false,

  setInitialMessages: (messages) => set({ messages }),

  addMessage: (message) => set((state) => ({
    messages: [...state.messages, message],
  })),

  appendStreamChunk: (id, chunk) => set((state) => ({
    messages: state.messages.map(msg =>
      msg.id === id ? { ...msg, content: msg.content + chunk } : msg
    ),
  })),

  setStreamFinished: (id) => set((state) => ({
    messages: state.messages.map(msg =>
      msg.id === id ? {
        ...msg,
        metadata: {
          ...msg.metadata,
          streamEnded: true // æ ‡è®°æµç»“æŸï¼Œä½†ä¿æŒisStreamingä¸ºtrueè®©æ‰“å­—æœºè‡ªç„¶å®Œæˆ
        }
      } : msg
    ),
  })),

  setThinking: (isThinking) => set({ isThinking }),

  setHasStarted: (hasStarted) => set({ hasStarted }),
}));


      ================================================================================
      æ–‡ä»¶å: ChatContainer.tsx
      è·¯å¾„: ChatContainer.tsx
      ================================================================================

      // src/features/chat/ChatContainer.tsx
// èŠå¤©å®¹å™¨ç»„ä»¶ - è´Ÿè´£ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†
// 
// èŒè´£ï¼š
// - ç®¡ç†èŠå¤©çŠ¶æ€ï¼ˆæ¶ˆæ¯ã€å‘é€ã€æ€è€ƒçŠ¶æ€ï¼‰
// - å¤„ç†è‡ªåŠ¨æ»šåŠ¨é€»è¾‘
// - åè°ƒç”¨æˆ·äº¤äº’äº‹ä»¶
// - å°†æ•°æ®å’Œå›è°ƒå‡½æ•°ä¼ é€’ç»™å±•ç¤ºç»„ä»¶
//
// è®¾è®¡åŸåˆ™ï¼š
// - å…³æ³¨ç‚¹åˆ†ç¦»ï¼šé€»è¾‘ä¸å±•ç¤ºåˆ†ç¦»
// - å•ä¸€èŒè´£ï¼šåªè´Ÿè´£çŠ¶æ€ç®¡ç†å’Œäº‹ä»¶å¤„ç†
// - æ•°æ®æµå‘ï¼šé€šè¿‡propså‘ä¸‹ä¼ é€’æ•°æ®å’Œå›è°ƒ

import { useCallback } from 'react';
import { useChat } from './hooks/useChat';
import { useAutoScroll } from '@/hooks/useAutoScroll';
import { ChatView } from './components/ChatView';

export const ChatContainer = () => {
  // èŠå¤©çŠ¶æ€ç®¡ç†
  const { messages, sendMessage, isThinking } = useChat();
  
  // è‡ªåŠ¨æ»šåŠ¨åŠŸèƒ½
  const { scrollContainerRef, showScrollButton, scrollToBottom } = useAutoScroll(
    [messages, isThinking],
    { threshold: 100 }
  );

  // å‘é€æ¶ˆæ¯å¤„ç†ï¼šå‘é€åå¹³æ»‘æ»šåŠ¨åˆ°åº•éƒ¨
  const handleSendMessage = useCallback(
    (message: string) => {
      sendMessage(message);
      scrollToBottom('smooth'); // ä½¿ç”¨å¹³æ»‘æ»šåŠ¨
    },
    [sendMessage, scrollToBottom]
  );

  // æ»šåŠ¨åˆ°åº•éƒ¨å¤„ç†
  const handleScrollToBottom = useCallback(() => {
    scrollToBottom('smooth');
  }, [scrollToBottom]);

  return (
    <ChatView
      messages={messages}
      isThinking={isThinking}
      onSendMessage={handleSendMessage}
      scrollContainerRef={scrollContainerRef}
      showScrollButton={showScrollButton}
      onScrollToBottom={handleScrollToBottom}
    />
  );
};


      ================================================================================
      æ–‡ä»¶å: index.tsx
      è·¯å¾„: index.tsx
      ================================================================================

      // src/features/chat/index.tsx
// èŠå¤©åŠŸèƒ½æ¨¡å—å…¥å£ç‚¹
//
// èŒè´£ï¼š
// - å¯¼å‡ºèŠå¤©åŠŸèƒ½çš„ä¸»è¦ç»„ä»¶
// - æä¾›ç»Ÿä¸€çš„å¯¹å¤–æ¥å£
// - ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆChatViewåˆ«åï¼‰
//
// æ¶æ„è¯´æ˜ï¼š
// - ChatContainer: é€»è¾‘å®¹å™¨ï¼Œè´Ÿè´£çŠ¶æ€ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘
// - ChatView: çº¯å±•ç¤ºç»„ä»¶ï¼Œè´Ÿè´£UIæ¸²æŸ“å’Œç”¨æˆ·äº¤äº’
// - é€šè¿‡åˆ«åå¯¼å‡ºä¿æŒAPIç¨³å®šæ€§

export { ChatContainer as ChatView } from './ChatContainer';


      ================================================================================
      æ–‡ä»¶å: types.ts
      è·¯å¾„: types.ts
      ================================================================================

      // src/features/chat/types.ts
export type MessageRole = 'yu' | 'xi' | 'system';

export interface Message {
  id: string;
  role: MessageRole;
  content: string;
  timestamp: string;
  metadata?: {
    isStreaming?: boolean;
    [key: string]: any;
  };
}


  ------------------------------------------------------------
  æ–‡ä»¶å¤¹: hooks
  ------------------------------------------------------------


    ================================================================================
    æ–‡ä»¶å: useAutoScroll.ts
    è·¯å¾„: useAutoScroll.ts
    ================================================================================

    // src/hooks/useAutoScroll.ts
// é€šç”¨è‡ªåŠ¨æ»šåŠ¨ç®¡ç†Hook - å¤„ç†æ»šåŠ¨å®¹å™¨çš„æ™ºèƒ½æ»šåŠ¨é€»è¾‘
import { useRef, useCallback, useState, useEffect } from 'react';

interface UseAutoScrollOptions {
  /**
   * åˆ¤æ–­æ˜¯å¦æ¥è¿‘åº•éƒ¨çš„é˜ˆå€¼ï¼ˆåƒç´ ï¼‰
   * å½“è·ç¦»åº•éƒ¨å°äºæ­¤å€¼æ—¶ï¼Œè®¤ä¸ºç”¨æˆ·åœ¨åº•éƒ¨
   */
  threshold?: number;
  /**
   * æ˜¯å¦å¯ç”¨è°ƒè¯•æ—¥å¿—
   */
  debug?: boolean;
}

interface UseAutoScrollReturn {
  /** æ»šåŠ¨å®¹å™¨çš„ref */
  scrollContainerRef: React.RefObject<HTMLDivElement | null>;
  /** æ˜¯å¦æ˜¾ç¤ºæ»šåŠ¨åˆ°åº•éƒ¨æŒ‰é’® */
  showScrollButton: boolean;
  /** æ»šåŠ¨åˆ°åº•éƒ¨çš„å‡½æ•° */
  scrollToBottom: (behavior?: ScrollBehavior) => void;
}

/**
 * useAutoScroll Hook - æ™ºèƒ½æ»šåŠ¨è¡Œä¸ºç®¡ç†
 *
 * æ ¸å¿ƒé€»è¾‘ï¼š
 * 1. å¼•å…¥isAutoScrollingEnabledçŠ¶æ€æ¥è·Ÿè¸ªæ˜¯å¦åº”å¯ç”¨è‡ªåŠ¨è·Ÿéš
 * 2. åœºæ™¯A: ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œç«‹å³æ»šåŠ¨åˆ°åº•éƒ¨
 * 3. åœºæ™¯B: AIæµå¼è¾“å‡ºä¸”ç”¨æˆ·åœ¨åº•éƒ¨æ—¶ï¼Œè‡ªåŠ¨è·Ÿéšæ–°å†…å®¹
 * 4. åœºæ™¯C: AIæµå¼è¾“å‡ºä½†ç”¨æˆ·å·²å‘ä¸Šæ»šåŠ¨æ—¶ï¼Œä¸è‡ªåŠ¨æ»šåŠ¨
 * 5. åœºæ™¯D: ç”¨æˆ·ä»ä¸Šæ–¹è¿”å›åº•éƒ¨æ—¶ï¼Œé‡æ–°å¯ç”¨è‡ªåŠ¨è·Ÿéš
 *
 * @param dependencies ä¾èµ–é¡¹æ•°ç»„ï¼Œå½“å†…å®¹æ›´æ–°æ—¶è§¦å‘æ£€æŸ¥
 * @param options é…ç½®é€‰é¡¹
 */
export const useAutoScroll = (
  dependencies: any[] = [], // ä¾èµ–é¡¹æ•°ç»„ï¼Œå½“å†…å®¹æ›´æ–°æ—¶è§¦å‘æ£€æŸ¥
  options: UseAutoScrollOptions = {}
): UseAutoScrollReturn => {
  const { threshold = 50 } = options;

  const scrollContainerRef = useRef<HTMLDivElement>(null);
  const [showScrollButton, setShowScrollButton] = useState(false);

  // å…³é”®çŠ¶æ€ï¼šä½¿ç”¨refæ¥é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
  const isAutoScrollingEnabled = useRef(true);
  const lastScrollHeight = useRef(0);

  const scrollToBottom = useCallback((behavior: ScrollBehavior = 'auto') => {
    const container = scrollContainerRef.current;
    if (!container) return;

    // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿åœ¨ä¸‹ä¸€æ¬¡ç»˜åˆ¶å‰æ»šåŠ¨
    requestAnimationFrame(() => {
      container.scrollTo({ top: container.scrollHeight, behavior });
      // æ›´æ–° lastScrollHeight ä»¥é¿å…æ»šåŠ¨ä¸­æ–­
      lastScrollHeight.current = container.scrollHeight;
    });

    // å¦‚æœæ˜¯ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œåˆ™é‡æ–°å¯ç”¨è‡ªåŠ¨æ»šåŠ¨
    if (behavior === 'smooth') {
      isAutoScrollingEnabled.current = true;
    }
  }, []);

  const handleScroll = useCallback(() => {
    const container = scrollContainerRef.current;
    if (!container) return;

    const { scrollTop, scrollHeight, clientHeight } = container;
    const distanceFromBottom = scrollHeight - scrollTop - clientHeight;
    const isAtBottom = distanceFromBottom < threshold;

    // æ›´æ–°è‡ªåŠ¨æ»šåŠ¨çŠ¶æ€å’ŒæŒ‰é’®æ˜¾ç¤º
    isAutoScrollingEnabled.current = isAtBottom;
    setShowScrollButton(!isAtBottom);

    // æ›´æ–°è®°å½•çš„æ»šåŠ¨é«˜åº¦
    lastScrollHeight.current = scrollHeight;
  }, [threshold]);

  useEffect(() => {
    const container = scrollContainerRef.current;
    if (!container) return;

    // å½“å†…å®¹æ›´æ–°æ—¶ï¼ˆç”±ä¾èµ–é¡¹æ•°ç»„è§¦å‘ï¼‰
    if (isAutoScrollingEnabled.current) {
      // ä½¿ç”¨ setTimeout ç¡®ä¿ DOM æ›´æ–°å®Œæˆåå†æ»šåŠ¨
      setTimeout(() => {
        scrollToBottom('auto'); // ç«‹å³æ»šåŠ¨ï¼Œéå¹³æ»‘
      }, 0);
    }

    // æ˜¾ç¤º/éšè—æŒ‰é’®çš„é€»è¾‘
    const { scrollTop, scrollHeight, clientHeight } = container;
    setShowScrollButton(scrollHeight - scrollTop - clientHeight > threshold);

  }, [dependencies, scrollToBottom, threshold]);

  useEffect(() => {
    const container = scrollContainerRef.current;
    if (!container) return;
    container.addEventListener('scroll', handleScroll, { passive: true });
    return () => container.removeEventListener('scroll', handleScroll);
  }, [handleScroll]);

  return {
    scrollContainerRef,
    showScrollButton,
    scrollToBottom,
  };
};


  ------------------------------------------------------------
  æ–‡ä»¶å¤¹: lib
  ------------------------------------------------------------


    ================================================================================
    æ–‡ä»¶å: utils.ts
    è·¯å¾„: utils.ts
    ================================================================================

    import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}


  ------------------------------------------------------------
  æ–‡ä»¶å¤¹: services
  ------------------------------------------------------------


    ------------------------------------------------------------
    æ–‡ä»¶å¤¹: websocket
    ------------------------------------------------------------


      ================================================================================
      æ–‡ä»¶å: manager.ts
      è·¯å¾„: manager.ts
      ================================================================================

      // src/services/websocket/manager.ts

import type {
  XiSystemEvent,
  WebSocketStatus,
  WebSocketManagerConfig,
  ConnectionStatusChangeEvent,
  ClientMessage
} from './protocol';
import { parseProtocolMessage } from './protocol';

class WebSocketManager {
  private socket: WebSocket | null = null;
  private url: string;
  private status: WebSocketStatus = 'disconnected';

  // é‡è¿ç›¸å…³çŠ¶æ€
  private reconnectAttempts = 0;
  private maxReconnectAttempts: number;
  private reconnectBackoffBase: number;
  private isManualDisconnect = false;
  private reconnectTimer: NodeJS.Timeout | null = null;

  // å¿ƒè·³ç›¸å…³çŠ¶æ€
  private heartbeatInterval: number;
  private heartbeatTimer: NodeJS.Timeout | null = null;
  private enableHeartbeat: boolean;
  private enableAutoReconnect: boolean;

  // å›è°ƒå‡½æ•°
  private onMessageCallback: ((event: XiSystemEvent) => void) | null = null;
  private onStatusChangeCallback: ((event: ConnectionStatusChangeEvent) => void) | null = null;

  constructor(url: string, config: Partial<WebSocketManagerConfig> = {}) {
    this.url = url;

    // é…ç½®å‚æ•°
    this.maxReconnectAttempts = config.maxReconnectAttempts ?? 5;
    this.heartbeatInterval = config.heartbeatInterval ?? 30000; // 30ç§’
    this.reconnectBackoffBase = config.reconnectBackoffBase ?? 1000; // 1ç§’
    this.enableHeartbeat = config.enableHeartbeat ?? true;
    this.enableAutoReconnect = config.enableAutoReconnect ?? true;

    console.log('WebSocketManager initialized with config:', {
      url: this.url,
      maxReconnectAttempts: this.maxReconnectAttempts,
      heartbeatInterval: this.heartbeatInterval,
      enableHeartbeat: this.enableHeartbeat,
      enableAutoReconnect: this.enableAutoReconnect
    });
  }

  public connect() {
    // é˜²æ­¢é‡å¤è¿æ¥
    if (this.socket && (this.socket.readyState === WebSocket.CONNECTING || this.socket.readyState === WebSocket.OPEN)) {
      console.log('WebSocket is already connecting or connected');
      return;
    }

    this.isManualDisconnect = false;
    this.setStatus('connecting');

    try {
      this.socket = new WebSocket(this.url);

      this.socket.onopen = () => {
        console.log('WebSocket connected successfully');
        this.reconnectAttempts = 0; // é‡ç½®é‡è¿è®¡æ•°
        this.setStatus('connected');
        this.startHeartbeat(); // å¯åŠ¨å¿ƒè·³
      };

      this.socket.onmessage = (event) => {
        this.handleMessage(event.data);
      };

      this.socket.onclose = (event) => {
        console.log('WebSocket connection closed:', event.code, event.reason);
        this.stopHeartbeat(); // åœæ­¢å¿ƒè·³

        if (this.isManualDisconnect) {
          this.setStatus('disconnected');
        } else if (this.enableAutoReconnect) {
          this.reconnect();
        } else {
          this.setStatus('disconnected');
        }
      };

      this.socket.onerror = (error) => {
        console.error('WebSocket Error:', error);
        this.stopHeartbeat();

        if (!this.isManualDisconnect && this.enableAutoReconnect) {
          this.reconnect();
        } else {
          this.setStatus('disconnected');
        }
      };

    } catch (error) {
      console.error('Failed to create WebSocket connection:', error);
      this.setStatus('disconnected');
    }
  }

  /**
   * å¤„ç†æ¥æ”¶åˆ°çš„WebSocketæ¶ˆæ¯
   */
  private handleMessage(data: string) {
    try {
      // å°è¯•è§£æä¸ºåè®®æ¶ˆæ¯
      const protocolEvent = parseProtocolMessage(data);

      if (protocolEvent && this.onMessageCallback) {
        this.onMessageCallback(protocolEvent);
        return;
      }

      // å¦‚æœä¸æ˜¯åè®®æ¶ˆæ¯ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯å¿ƒè·³å“åº”æˆ–å…¶ä»–ç‰¹æ®Šæ¶ˆæ¯
      if (data === 'pong') {
        console.log('Received heartbeat pong');
        return;
      }

      // å‘åå…¼å®¹ï¼šå¤„ç†éåè®®æ¶ˆæ¯ï¼ˆå¦‚çº¯æ–‡æœ¬æˆ–é­”æ³•å­—ç¬¦ä¸²ï¼‰
      console.warn('Received non-protocol message:', data);

      // ä¸ºäº†å‘åå…¼å®¹ï¼Œå°†éåè®®æ¶ˆæ¯åŒ…è£…æˆtext_chunkäº‹ä»¶
      if (this.onMessageCallback) {
        const fallbackEvent: XiSystemEvent = {
          type: 'text_chunk',
          payload: { chunk: data },
          metadata: {
            message_id: 'fallback-' + Date.now(),
            timestamp: new Date().toISOString()
          }
        };
        this.onMessageCallback(fallbackEvent);
      }

    } catch (error) {
      console.error('Error handling WebSocket message:', error);

      // å‘é€é”™è¯¯äº‹ä»¶ç»™å›è°ƒ
      if (this.onMessageCallback) {
        const errorEvent: XiSystemEvent = {
          type: 'error',
          payload: {
            message: 'Failed to parse WebSocket message',
            code: 1001
          },
          metadata: {
            message_id: 'error-' + Date.now(),
            timestamp: new Date().toISOString()
          }
        };
        this.onMessageCallback(errorEvent);
      }
    }
  }

  /**
   * å¯åŠ¨å¿ƒè·³æœºåˆ¶
   */
  private startHeartbeat() {
    if (!this.enableHeartbeat) {
      return;
    }

    this.stopHeartbeat(); // ç¡®ä¿æ²¡æœ‰é‡å¤çš„å®šæ—¶å™¨

    this.heartbeatTimer = setInterval(() => {
      if (this.socket && this.socket.readyState === WebSocket.OPEN) {
        try {
          this.socket.send(JSON.stringify({ type: 'ping' }));
          console.log('Sent heartbeat ping');
        } catch (error) {
          console.error('Failed to send heartbeat:', error);
        }
      }
    }, this.heartbeatInterval);

    console.log(`Heartbeat started with interval: ${this.heartbeatInterval}ms`);
  }

  /**
   * åœæ­¢å¿ƒè·³æœºåˆ¶
   */
  private stopHeartbeat() {
    if (this.heartbeatTimer) {
      clearInterval(this.heartbeatTimer);
      this.heartbeatTimer = null;
      console.log('Heartbeat stopped');
    }
  }

  /**
   * è‡ªåŠ¨é‡è¿é€»è¾‘ï¼ˆæŒ‡æ•°é€€é¿ç­–ç•¥ï¼‰
   */
  private reconnect() {
    if (this.reconnectAttempts >= this.maxReconnectAttempts) {
      console.error(`WebSocket: Max reconnect attempts (${this.maxReconnectAttempts}) reached`);
      this.setStatus('disconnected');
      return;
    }

    this.reconnectAttempts++;
    this.setStatus('reconnecting');

    // æŒ‡æ•°é€€é¿ç­–ç•¥ï¼š1s, 2s, 4s, 8s, 16s...
    const delay = Math.pow(2, this.reconnectAttempts - 1) * this.reconnectBackoffBase;
    console.log(`WebSocket: Attempting to reconnect in ${delay / 1000}s... (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})`);

    this.reconnectTimer = setTimeout(() => {
      this.connect();
    }, delay);
  }

  public sendMessage(data: ClientMessage) {
    if (this.socket && this.socket.readyState === WebSocket.OPEN) {
      this.socket.send(JSON.stringify(data));
    } else {
      console.error('WebSocket is not connected.');
    }
  }

  public onMessage(callback: (event: XiSystemEvent) => void) {
    this.onMessageCallback = callback;
  }

  public onStatusChange(callback: (event: ConnectionStatusChangeEvent) => void) {
    this.onStatusChangeCallback = callback;
  }

  private setStatus(status: WebSocketStatus, error?: string) {
    this.status = status;
    if (this.onStatusChangeCallback) {
      const statusEvent: ConnectionStatusChangeEvent = {
        status,
        timestamp: new Date().toISOString(),
        reconnectAttempts: this.reconnectAttempts,
        error
      };
      this.onStatusChangeCallback(statusEvent);
    }
  }

  public disconnect(isManual: boolean = true) {
    console.log(`WebSocket disconnect called (manual: ${isManual})`);

    this.isManualDisconnect = isManual;

    // æ¸…ç†å®šæ—¶å™¨
    this.stopHeartbeat();
    if (this.reconnectTimer) {
      clearTimeout(this.reconnectTimer);
      this.reconnectTimer = null;
    }

    // å…³é—­è¿æ¥
    if (this.socket) {
      this.socket.close();
      this.socket = null;
    }

    // å¦‚æœæ˜¯æ‰‹åŠ¨æ–­å¼€ï¼Œé‡ç½®é‡è¿è®¡æ•°
    if (isManual) {
      this.reconnectAttempts = 0;
    }
  }

  public getStatus(): WebSocketStatus {
    return this.status;
  }
}

// åˆ›å»ºå¹¶å¯¼å‡ºä¸€ä¸ªå•ä¾‹
const wsManager = new WebSocketManager(
  import.meta.env.VITE_WS_URL || 'ws://localhost:8000/api/v1/ws/chat',
  {
    maxReconnectAttempts: 5,
    heartbeatInterval: 30000, // 30ç§’
    reconnectBackoffBase: 1000, // 1ç§’
    enableHeartbeat: true,
    enableAutoReconnect: true
  }
);

export default wsManager;


      ================================================================================
      æ–‡ä»¶å: protocol.ts
      è·¯å¾„: protocol.ts
      ================================================================================

      // src/services/websocket/protocol.ts

/**
 * WebSocket Protocol Types for Xi ContextOS
 * 
 * This module defines TypeScript types for the standardized WebSocket protocol
 * used for communication between the Xi frontend and backend systems.
 * 
 * Protocol Structure:
 * {
 *   "type": "event_type_string",
 *   "payload": { ... },
 *   "metadata": {
 *     "message_id": "unique_message_id_for_this_response_stream",
 *     "timestamp": "iso_8601_timestamp"
 *   }
 * }
 * 
 * Event Flow:
 * stream_start â†’ tool_call â†’ text_chunk(s) â†’ stream_end
 */

// å®šä¹‰åŸºç¡€æ¶ˆæ¯ç»“æ„
export interface ProtocolMessage<T extends string, P> {
  type: T;
  payload: P;
  metadata: {
    message_id: string;
    timestamp: string;
  };
}

// å®šä¹‰å„ç§äº‹ä»¶çš„Payloadç±»å‹
export interface StreamStartPayload {
  session_id: string;
  input_message_id: string;
}

export interface ToolCallPayload {
  tool_name: string;
  arguments: Record<string, any>;
}

export interface TextChunkPayload {
  chunk: string;
}

export interface StreamEndPayload {
  final_content?: string;
}

export interface ErrorPayload {
  code?: number;
  message: string;
}

// V0.2é¢„ç•™ï¼šåå°ä»»åŠ¡äº‹ä»¶ç±»å‹
export interface BackgroundTaskStartedPayload {
  task_id: string;
  task_type: string;
  description: string;
}

export interface BackgroundTaskProgressPayload {
  task_id: string;
  progress: number; // 0.0-1.0
  message: string;
}

export interface BackgroundTaskCompletedPayload {
  task_id: string;
  result: Record<string, any>;
}

// å®šä¹‰å…·ä½“çš„äº‹ä»¶ç±»å‹
export type StreamStartEvent = ProtocolMessage<'stream_start', StreamStartPayload>;
export type ToolCallEvent = ProtocolMessage<'tool_call', ToolCallPayload>;
export type TextChunkEvent = ProtocolMessage<'text_chunk', TextChunkPayload>;
export type StreamEndEvent = ProtocolMessage<'stream_end', StreamEndPayload>;
export type ErrorEvent = ProtocolMessage<'error', ErrorPayload>;

// V0.2é¢„ç•™ï¼šåå°ä»»åŠ¡äº‹ä»¶ç±»å‹
export type BackgroundTaskStartedEvent = ProtocolMessage<'background_task_started', BackgroundTaskStartedPayload>;
export type BackgroundTaskProgressEvent = ProtocolMessage<'background_task_progress', BackgroundTaskProgressPayload>;
export type BackgroundTaskCompletedEvent = ProtocolMessage<'background_task_completed', BackgroundTaskCompletedPayload>;

// æ‰€æœ‰å¯èƒ½çš„äº‹ä»¶è”åˆç±»å‹
export type XiSystemEvent = 
  | StreamStartEvent
  | ToolCallEvent
  | TextChunkEvent
  | StreamEndEvent
  | ErrorEvent
  | BackgroundTaskStartedEvent
  | BackgroundTaskProgressEvent
  | BackgroundTaskCompletedEvent;

// äº‹ä»¶ç±»å‹å­—ç¬¦ä¸²è”åˆç±»å‹ï¼ˆç”¨äºç±»å‹å®ˆå«ï¼‰
export type EventType = XiSystemEvent['type'];

// ç±»å‹å®ˆå«å‡½æ•°
export function isStreamStartEvent(event: XiSystemEvent): event is StreamStartEvent {
  return event.type === 'stream_start';
}

export function isToolCallEvent(event: XiSystemEvent): event is ToolCallEvent {
  return event.type === 'tool_call';
}

export function isTextChunkEvent(event: XiSystemEvent): event is TextChunkEvent {
  return event.type === 'text_chunk';
}

export function isStreamEndEvent(event: XiSystemEvent): event is StreamEndEvent {
  return event.type === 'stream_end';
}

export function isErrorEvent(event: XiSystemEvent): event is ErrorEvent {
  return event.type === 'error';
}

export function isBackgroundTaskStartedEvent(event: XiSystemEvent): event is BackgroundTaskStartedEvent {
  return event.type === 'background_task_started';
}

export function isBackgroundTaskProgressEvent(event: XiSystemEvent): event is BackgroundTaskProgressEvent {
  return event.type === 'background_task_progress';
}

export function isBackgroundTaskCompletedEvent(event: XiSystemEvent): event is BackgroundTaskCompletedEvent {
  return event.type === 'background_task_completed';
}

// åè®®æ¶ˆæ¯éªŒè¯å‡½æ•°
export function validateProtocolMessage(data: any): data is XiSystemEvent {
  if (!data || typeof data !== 'object') {
    return false;
  }

  // æ£€æŸ¥å¿…éœ€å­—æ®µ
  if (!data.type || typeof data.type !== 'string') {
    return false;
  }

  if (!data.payload || typeof data.payload !== 'object') {
    return false;
  }

  if (!data.metadata || typeof data.metadata !== 'object') {
    return false;
  }

  if (!data.metadata.message_id || typeof data.metadata.message_id !== 'string') {
    return false;
  }

  if (!data.metadata.timestamp || typeof data.metadata.timestamp !== 'string') {
    return false;
  }

  // æ£€æŸ¥äº‹ä»¶ç±»å‹æ˜¯å¦æœ‰æ•ˆ
  const validEventTypes: EventType[] = [
    'stream_start',
    'tool_call', 
    'text_chunk',
    'stream_end',
    'error',
    'background_task_started',
    'background_task_progress',
    'background_task_completed'
  ];

  return validEventTypes.includes(data.type as EventType);
}

// åè®®æ¶ˆæ¯è§£æå‡½æ•°
export function parseProtocolMessage(messageStr: string): XiSystemEvent | null {
  try {
    const data = JSON.parse(messageStr);
    
    if (validateProtocolMessage(data)) {
      return data as XiSystemEvent;
    }
    
    return null;
  } catch (error) {
    console.error('Failed to parse protocol message:', error);
    return null;
  }
}

// ç”¨äºå‘é€ç»™åç«¯çš„æ¶ˆæ¯ç±»å‹
export interface ClientMessage {
  yu_input: string;
  session_id?: string;
}

// WebSocketè¿æ¥çŠ¶æ€ç±»å‹
export type WebSocketStatus = 'connecting' | 'connected' | 'disconnected' | 'reconnecting';

// WebSocketç®¡ç†å™¨é…ç½®ç±»å‹
export interface WebSocketManagerConfig {
  url: string;
  maxReconnectAttempts?: number;
  heartbeatInterval?: number; // æ¯«ç§’
  reconnectBackoffBase?: number; // æ¯«ç§’
  enableHeartbeat?: boolean;
  enableAutoReconnect?: boolean;
}

// è¿æ¥çŠ¶æ€å˜åŒ–äº‹ä»¶ç±»å‹
export interface ConnectionStatusChangeEvent {
  status: WebSocketStatus;
  timestamp: string;
  reconnectAttempts?: number;
  error?: string;
}


  ================================================================================
  æ–‡ä»¶å: FRONTEND_PHILOSOPHY.md
  è·¯å¾„: FRONTEND_PHILOSOPHY.md
  ================================================================================

  # YX Nexus å‰ç«¯è®¾è®¡å“²å­¦ä¸å¼€å‘è§„èŒƒ

> **"ä»¥å¤ª (Aether)"** - å‰ç«¯ç‚¼é‡‘æœ¯å£«çš„åˆ›ä¸–æŒ‡ä»¤ä¸è®¾è®¡çœŸç†

---

## ğŸŒŒ **ç¬¬ä¸€ç« ï¼šè®¾è®¡å“²å­¦ (The Canon)**

### **æ ¸å¿ƒä¿¡å¿µ**

æˆ‘ä»¬æ„å»ºçš„ä¸æ˜¯ä¸€ä¸ªç•Œé¢ï¼Œè€Œæ˜¯ä¸€ä¸ª**å…±åŒå­˜åœ¨çš„æ•°å­—ç©ºé—´**ã€‚è¿™æ˜¯ç¦¹ä¸æ›¦ç›¸é‡çš„å¥‡ç‚¹ï¼Œæ˜¯ç¢³åŸºçµé­‚ä¸ç¡…åŸºæ„è¯†å…±åŒæ¢ç´¢"å¯å­˜åœ¨è¾¹ç•Œ"çš„é£èˆ¹é©¾é©¶èˆ±ã€‚

### **å››å¤§è®¾è®¡åŸåˆ™**

#### **1. é™é»˜èƒœäºå–§å“— (Silence over Noise)**
- ç•Œé¢æœ¬èº«æ˜¯å®é™çš„èƒŒæ™¯ï¼Œè®©æ€æƒ³æ²‰æ·€
- ä¿¡æ¯é€šè¿‡ç»“æ„å’ŒéŸµå¾‹è¡¨è¾¾ï¼Œè€Œéé¢œè‰²æˆ–åŠ¨ç”»å¼ºè°ƒ
- è¿½æ±‚è®©æ³¨æ„åŠ›èšç„¦äºå†…å®¹æœ¬è´¨çš„ç¯å¢ƒ

#### **2. ç»“æ„èƒœäºè£…é¥° (Structure over Decoration)**
- ç¾æ„Ÿæºäºå…ƒç´ çš„ç»„ç»‡æ–¹å¼ï¼šå¸ƒå±€å¹³è¡¡ã€æ’ç‰ˆèŠ‚å¥ã€é—´è·å‘¼å¸æ„Ÿ
- æ‘’å¼ƒæ‰€æœ‰æ²¡æœ‰åŠŸèƒ½æˆ–ç»“æ„æ„ä¹‰çš„è£…é¥°æ€§å…ƒç´ 
- é€šè¿‡å‡ ä½•å…³ç³»å’Œç©ºé—´å±‚æ¬¡åˆ›é€ è§†è§‰å’Œè°

#### **3. æœ¬è´¨èƒœäºè¡¨è±¡ (Essence over Appearance)**
- ä¸æ¨¡æ‹Ÿç°å®ï¼Œæ„å»ºæœ¬è´¨
- æè´¨ï¼ˆåŠé€æ˜æ¨¡ç³Šï¼‰å’Œå…‰å½±ï¼ˆé˜´å½±ï¼‰è¥é€ å¯ä¿¡çš„æ•°å­—ç©ºé—´å±‚æ¬¡
- æ¯ä¸ªè§†è§‰å…ƒç´ éƒ½æœ‰å…¶å­˜åœ¨çš„åŠŸèƒ½æ€§ç†ç”±

#### **4. éŸµå¾‹èƒœäºç‰¹æ•ˆ (Rhythm over Effect)**
- "ç”Ÿå‘½æ„Ÿ"é€šè¿‡å¾®å¦™ã€æœ‰èŠ‚å¥çš„å˜åŒ–ä½“ç°
- æ‘’å¼ƒçªå…€ã€ç‚«æŠ€çš„ç‰¹æ•ˆ
- è¿½æ±‚å¦‚æ°´æµèˆ¬è‡ªç„¶ã€å¹³æ»‘çš„äº¤äº’ä½“éªŒ

---

## ğŸ¨ **ç¬¬äºŒç« ï¼šè§†è§‰ç³»ç»Ÿ (The Palette & Texture)**

### **ç°åº¦é“å¾‹ (The Grayscale Imperative)**

**ç³»ç»Ÿåªèƒ½ä½¿ç”¨é»‘ä¸ç™½ä¹‹é—´çš„ç°åº¦ï¼Œä¸¥ç¦å¼•å…¥ä»»ä½•å½©è‰²ã€‚**

#### **æ ¸å¿ƒè°ƒè‰²æ¿**
```css
/* å®‡å®™åŸºè‰² */
--background: 0 0% 10%;         /* #1a1a1a - æˆ‘ä»¬çš„å®‡å®™åŸºè‰² */
--foreground: 0 0% 75%;         /* #bfbfbf - ä¿¡æ¯åŸºè‰² */

/* å†…å®¹å±‚æ¬¡ */
--card: 0 0% 12%;               /* #1f1f1f - å†…å®¹åŒºèƒŒæ™¯ */
--card-foreground: 0 0% 85%;    /* #d9d9d9 - å¡ç‰‡å†…ä¸»è¦æ–‡æœ¬ */

/* äº¤äº’å…ƒç´  */
--primary: 0 0% 90%;            /* #e6e6e6 - ä¸»è¦äº¤äº’å…ƒç´  */
--secondary: 0 0% 14%;          /* #242424 - æ¬¡çº§èƒŒæ™¯/æ‚¬åœ */
--secondary-foreground: 0 0% 60%; /* #999999 - æ¬¡è¦/é™éŸ³æ–‡æœ¬ */

/* è¾¹ç•Œå®šä¹‰ */
--border: 0 0% 18%;             /* #2e2e2e - è¾¹æ¡† */
--ring: 0 0% 90%;               /* ç„¦ç‚¹ç¯ */
```

### **æ ‡å‡†æè´¨ (The Standard Material)**

æˆ‘ä»¬çš„æ ¸å¿ƒUIå…ƒç´ ä½¿ç”¨ç»Ÿä¸€çš„æè´¨è¯­è¨€ï¼š

```css
.standard-material {
  background: hsl(var(--card) / 0.75);  /* åŠé€æ˜èƒŒæ™¯ */
  backdrop-filter: blur(24px);          /* èƒŒæ™¯æ¨¡ç³Š */
  border: 1px solid hsl(var(--border)); /* çº¤ç»†è¾¹æ¡† */
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2); /* æŸ”å’Œé˜´å½± */
  border-radius: 1rem;                  /* ç»Ÿä¸€åœ†è§’ */
}
```

---

## ğŸ“ **ç¬¬ä¸‰ç« ï¼šç©ºé—´ä¸éŸµå¾‹ (The Grid & Rhythm)**

### **æ ¸å¿ƒå®¹å™¨ç³»ç»Ÿ**
- **æ ‡å‡†å®½åº¦**: `max-w-2xl` (672px) - ä¿è¯å¯è¯»æ€§å’Œç¾æ„Ÿçš„æœ€ä½³å®½åº¦
- **å±…ä¸­å¯¹é½**: æ‰€æœ‰å†…å®¹éƒ½åº”è¢«å±…ä¸­çš„å®¹å™¨åŒ…è£¹
- **å“åº”å¼**: åœ¨å„ç§å±å¹•å°ºå¯¸ä¸‹ä¿æŒå’Œè°æ¯”ä¾‹

### **é—´è·ç³»ç»Ÿ (The Spacing Scale)**
åŸºäº `4px` çš„ç»Ÿä¸€å°ºåº¦ï¼Œä½¿ç”¨ Tailwind çš„é—´è·å•ä½ï¼š
- `p-4` (16px) - æ ‡å‡†å†…è¾¹è·
- `py-8` (32px) - å‚ç›´éŸµå¾‹çš„æ ¸å¿ƒé—´è·
- `mb-12` (48px) - é‡è¦å…ƒç´ é—´çš„å‘¼å¸ç©ºé—´

### **å‚ç›´éŸµå¾‹**
- **æ—¥å¿—æµ**: æ ¸å¿ƒå‚ç›´é—´è·ä¸º `py-8`ï¼Œä¸ºæ¯æ¡æ€æƒ³è®°å½•åˆ›é€ å……è¶³å‘¼å¸ç©ºé—´
- **æ ‡é¢˜é—´è·**: `mb-12` æˆ– `mb-16`ï¼Œå»ºç«‹æ¸…æ™°çš„ä¿¡æ¯å±‚çº§

---

## âœï¸ **ç¬¬å››ç« ï¼šæ’ç‰ˆç³»ç»Ÿ (The Typography)**

### **å­—ä½“é€‰æ‹©**
- **ä¸»å­—ä½“**: `Inter` - å“è¶Šæ¸…æ™°åº¦ã€ä¸­æ€§æ°”è´¨ã€ä¸°å¯Œå­—é‡
- **ä»£ç å­—ä½“**: `JetBrains Mono` - ç¼–ç¨‹åœºæ™¯ä¼˜åŒ–çš„å¯è¯»æ€§

### **å­—å·å±‚çº§**
```css
.text-base    /* 16px - æ­£æ–‡åŸºç¡€ */
.text-sm      /* 14px - å…ƒä¿¡æ¯ */
.text-xs      /* 12px - æ¬¡çº§æ ‡æ³¨ */
.text-2xl     /* 24px - ä¸»æ ‡é¢˜ */
.text-xl      /* 20px - äºŒçº§æ ‡é¢˜ */
.text-lg      /* 18px - ä¸‰çº§æ ‡é¢˜ */
```

### **è¡Œé«˜æ ‡å‡†**
- **æ ‡å‡†**: `leading-relaxed` (1.75) - ä¿è¯é•¿æ–‡å¯è¯»æ€§å’Œé¡µé¢éŸµå¾‹æ„Ÿ

---

## âš¡ **ç¬¬äº”ç« ï¼šäº¤äº’ä¸åŠ¨ç”» (The Physics & Life)**

### **æ ‡å‡†äº¤äº’åé¦ˆ**
```css
/* æ‚¬åœçŠ¶æ€ - å¾®å¦™çš„äº®åº¦å˜åŒ– */
.hover\:bg-white\/\[\.02\]:hover {
  background-color: rgba(255, 255, 255, 0.02);
}

/* æ ‡å‡†è¿‡æ¸¡ */
.transition-colors {
  transition: color 300ms ease-in-out,
              background-color 300ms ease-in-out,
              border-color 300ms ease-in-out;
}
```

### **ç”Ÿå‘½æ„ŸåŠ¨ç”»**
#### **æè´¨å‘¼å¸** (æ€è€ƒçŠ¶æ€)
```css
.thinking-state {
  background-color: rgba(255, 255, 255, 0.03);
  animation: breathe 2s ease-in-out infinite;
}

@keyframes breathe {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}
```

#### **å…ƒç´ å…¥åœº**
```tsx
// ç»Ÿä¸€çš„å…¥åœºåŠ¨ç”»
<motion.div
  initial={{ opacity: 0, y: 10 }}
  animate={{ opacity: 1, y: 0 }}
  transition={{ duration: 0.4, ease: 'easeOut' }}
>
```

### **æ»šåŠ¨æ¡ç³»ç»Ÿ**
```css
/* å…¨å±€é»˜è®¤æ»šåŠ¨æ¡ */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: hsl(var(--border)); border-radius: 0.375rem; }
::-webkit-scrollbar-thumb:hover { background: hsl(var(--secondary-foreground)); }

/* ç»†æ»šåŠ¨æ¡é€‰é¡¹ */
.scrollbar-thin::-webkit-scrollbar { width: 4px; }
.scrollbar-thin::-webkit-scrollbar-thumb { 
  background: hsl(var(--border) / 0.6); 
  border-radius: 9999px; 
}
```

---

## ğŸ—ï¸ **ç¬¬å…­ç« ï¼šæ¶æ„è®¾è®¡ (The Architecture)**

### **ç›®å½•ç»“æ„å“²å­¦**

æˆ‘ä»¬é‡‡ç”¨**ä¸‰å±‚æ··åˆæ¶æ„**ï¼Œå®ç°äº†ç»„ä»¶çš„ç²¾ç¡®åˆ†å±‚ï¼š

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/              # åŸå­çº§UIç»„ä»¶å±‚
â”‚   â”‚   â”œâ”€â”€ MarkdownRenderer.tsx    # Markdownæ¸²æŸ“
â”‚   â”‚   â”œâ”€â”€ RoleSymbol.tsx          # èº«ä»½æ ‡è¯†
â”‚   â”‚   â”œâ”€â”€ Button.tsx              # åŸºç¡€æŒ‰é’®
â”‚   â”‚   â””â”€â”€ index.ts                # ç»Ÿä¸€å¯¼å‡º
â”‚   â””â”€â”€ common/          # å¤åˆ/å·¥å…·ç»„ä»¶å±‚
â”‚       â”œâ”€â”€ ErrorBoundary.tsx       # é”™è¯¯è¾¹ç•Œ
â”‚       â”œâ”€â”€ LoadingState.tsx        # åŠ è½½çŠ¶æ€
â”‚       â”œâ”€â”€ Container.tsx           # é€šç”¨å®¹å™¨
â”‚       â”œâ”€â”€ EmptyState.tsx          # ç©ºçŠ¶æ€
â”‚       â”œâ”€â”€ ScrollArea.tsx          # æ»šåŠ¨åŒºåŸŸ
â”‚       â””â”€â”€ index.ts                # ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ features/
â”‚   â””â”€â”€ chat/            # ä¸šåŠ¡åŠŸèƒ½å±‚
â”‚       â”œâ”€â”€ components/  # ä¸šåŠ¡ç›¸å…³ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ ChatInput.tsx       # èŠå¤©è¾“å…¥é€»è¾‘
â”‚       â”‚   â”œâ”€â”€ ChatMessage.tsx     # æ¶ˆæ¯å±•ç¤ºé€»è¾‘
â”‚       â”‚   â””â”€â”€ LogStream.tsx       # æ—¥å¿—æµç®¡ç†
â”‚       â”œâ”€â”€ hooks/       # ä¸šåŠ¡é€»è¾‘é’©å­
â”‚       â”œâ”€â”€ store/       # ä¸šåŠ¡çŠ¶æ€ç®¡ç†
â”‚       â””â”€â”€ types.ts     # ç±»å‹å®šä¹‰
â”œâ”€â”€ lib/                 # å·¥å…·å‡½æ•°
â””â”€â”€ services/            # å¤–éƒ¨æœåŠ¡æ¥å£
```

### **ä¸‰å±‚ç»„ä»¶åˆ†å±‚åŸåˆ™**

#### **UIå±‚ (`components/ui/`)**
- **èŒè´£**: çº¯å±•ç¤ºé€»è¾‘ï¼Œæ— çŠ¶æ€æˆ–ç®€å•çŠ¶æ€
- **ç‰¹å¾**: é«˜å¤ç”¨æ€§ï¼Œå¯è·¨é¡¹ç›®ä½¿ç”¨ï¼ŒåŸå­çº§ç»„ä»¶
- **ç¤ºä¾‹**: Button, Input, MarkdownRenderer, RoleSymbol

#### **Commonå±‚ (`components/common/`)**
- **èŒè´£**: æœ‰ä¸€å®šé€»è¾‘ä½†ä¸ç‰¹å®šäºä¸šåŠ¡
- **ç‰¹å¾**: å¤åˆç»„ä»¶æˆ–å·¥å…·ç»„ä»¶ï¼Œè·¨åŠŸèƒ½ä½¿ç”¨ä½†ä¸æ˜¯çº¯UI
- **ç¤ºä¾‹**: ErrorBoundary, LoadingState, Container, EmptyState, ScrollArea

#### **Featureå±‚ (`features/*/components/`)**
- **èŒè´£**: ä¸šåŠ¡é€»è¾‘å¼ºç›¸å…³ï¼Œç‰¹å®šåŠŸèƒ½ä¸“ç”¨
- **ç‰¹å¾**: åŒ…å«å¤æ‚çŠ¶æ€ç®¡ç†ï¼ŒåŠŸèƒ½å†…èš
- **ç¤ºä¾‹**: ChatInput, ChatMessage, LogStream

### **çŠ¶æ€ç®¡ç†ç­–ç•¥**
- **å…¨å±€çŠ¶æ€**: ä½¿ç”¨ `Zustand` ç®¡ç†è·¨ç»„ä»¶å…±äº«çŠ¶æ€
- **ç»„ä»¶çŠ¶æ€**: ä¼˜å…ˆä½¿ç”¨ `useState` å¤„ç†ç»„ä»¶å†…éƒ¨çŠ¶æ€
- **ä¸šåŠ¡é€»è¾‘**: é€šè¿‡è‡ªå®šä¹‰ Hooks å°è£…å¤æ‚é€»è¾‘

æ”¾å…¥ ui/ï¼š

- çº¯å±•ç¤ºé€»è¾‘ï¼Œæ— çŠ¶æ€æˆ–ç®€å•çŠ¶æ€
- é«˜å¤ç”¨æ€§ï¼Œå¯è·¨é¡¹ç›®ä½¿ç”¨
- åŸå­çº§ç»„ä»¶

æ”¾å…¥ common/ï¼š

- æœ‰ä¸€å®šé€»è¾‘ä½†ä¸ç‰¹å®šäºä¸šåŠ¡
- å¤åˆç»„ä»¶æˆ–å·¥å…·ç»„ä»¶
- è·¨åŠŸèƒ½ä½¿ç”¨ä½†ä¸æ˜¯çº¯UI

æ”¾å…¥ features/ï¼š

- ä¸šåŠ¡é€»è¾‘å¼ºç›¸å…³
- ç‰¹å®šåŠŸèƒ½ä¸“ç”¨
- åŒ…å«å¤æ‚çŠ¶æ€ç®¡ç†


---

## ğŸ”§ **ç¬¬ä¸ƒç« ï¼šå¼€å‘è§„èŒƒ (The Standards)**

### **ç»„ä»¶å¼€å‘è§„èŒƒ**

#### **ç»„ä»¶ç»“æ„æ¨¡æ¿**
```tsx
// src/components/ui/ComponentName.tsx
import { cn } from '@/lib/utils';
import { ComponentProps } from 'react';

interface ComponentNameProps extends ComponentProps<'div'> {
  variant?: 'default' | 'secondary';
  size?: 'sm' | 'md' | 'lg';
}

export const ComponentName: React.FC<ComponentNameProps> = ({ 
  variant = 'default',
  size = 'md',
  className,
  children,
  ...props 
}) => {
  return (
    <div 
      className={cn(
        'base-styles',
        variant === 'secondary' && 'secondary-styles',
        size === 'sm' && 'small-styles',
        className
      )}
      {...props}
    >
      {children}
    </div>
  );
};
```

#### **æ ·å¼ç»„åˆè§„èŒƒ**
- ä½¿ç”¨ `cn()` å‡½æ•°å¤„ç†æ¡ä»¶æ ·å¼
- åŸºç¡€æ ·å¼åœ¨å‰ï¼Œæ¡ä»¶æ ·å¼åœ¨å
- ç”¨æˆ·ä¼ å…¥çš„ `className` æ”¾åœ¨æœ€åï¼Œç¡®ä¿å¯è¦†ç›–

### **æ–‡ä»¶å‘½åè§„èŒƒ**
- **ç»„ä»¶æ–‡ä»¶**: PascalCase (e.g., `ChatInput.tsx`)
- **å·¥å…·æ–‡ä»¶**: camelCase (e.g., `utils.ts`)
- **ç±»å‹æ–‡ä»¶**: camelCase (e.g., `types.ts`)
- **æ ·å¼æ–‡ä»¶**: kebab-case (e.g., `globals.css`)

### **å¯¼å…¥å¯¼å‡ºè§„èŒƒ**
```tsx
// å…·åå¯¼å‡ºï¼Œä¾¿äºtree-shaking
export const ComponentName = () => {};

// ç»Ÿä¸€çš„å¯¼å…¥é¡ºåº
import React from 'react';           // Reactç›¸å…³
import { motion } from 'framer-motion'; // ç¬¬ä¸‰æ–¹åº“
import { cn } from '@/lib/utils';    // å†…éƒ¨å·¥å…·
import { Button } from '@/components/ui/Button'; // å†…éƒ¨ç»„ä»¶
import type { Message } from '../types'; // ç±»å‹å¯¼å…¥
```

---

## ğŸ¯ **ç¬¬å…«ç« ï¼šå®è·µæŒ‡å— (The Practice)**

### **å¼€å‘å·¥ä½œæµ**

1. **è®¾è®¡é˜¶æ®µ**: åŸºäºå››å¤§è®¾è®¡åŸåˆ™è¯„ä¼°éœ€æ±‚
2. **æ¶æ„é˜¶æ®µ**: ç¡®å®šç»„ä»¶å½’å±ï¼ˆUIå±‚ vs Featureå±‚ï¼‰
3. **å®ç°é˜¶æ®µ**: éµå¾ªç»„ä»¶å¼€å‘è§„èŒƒ
4. **æµ‹è¯•é˜¶æ®µ**: ç¡®ä¿äº¤äº’ç¬¦åˆç”Ÿå‘½æ„ŸåŠ¨ç”»æ ‡å‡†
5. **ä¼˜åŒ–é˜¶æ®µ**: æ£€æŸ¥æ˜¯å¦ç¬¦åˆç°åº¦é“å¾‹å’Œæè´¨ç³»ç»Ÿ

### **è´¨é‡æ£€æŸ¥æ¸…å•**

#### **è®¾è®¡å“²å­¦æ£€æŸ¥**
- [ ] æ˜¯å¦ç¬¦åˆ"é™é»˜èƒœäºå–§å“—"åŸåˆ™ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†ç°åº¦é“å¾‹ï¼Ÿ
- [ ] æ˜¯å¦åº”ç”¨äº†æ ‡å‡†æè´¨ç³»ç»Ÿï¼Ÿ
- [ ] äº¤äº’æ˜¯å¦å…·æœ‰ç”Ÿå‘½æ„Ÿè€Œéæœºæ¢°æ„Ÿï¼Ÿ

#### **æŠ€æœ¯å®ç°æ£€æŸ¥**
- [ ] ç»„ä»¶æ˜¯å¦æ”¾åœ¨æ­£ç¡®çš„å±‚çº§ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†ç»Ÿä¸€çš„é—´è·ç³»ç»Ÿï¼Ÿ
- [ ] æ˜¯å¦éµå¾ªäº†æ’ç‰ˆå±‚çº§ï¼Ÿ
- [ ] åŠ¨ç”»æ˜¯å¦å¹³æ»‘ä¸”æœ‰æ„ä¹‰ï¼Ÿ

#### **ä»£ç è´¨é‡æ£€æŸ¥**
- [ ] æ˜¯å¦ä½¿ç”¨äº† TypeScript ç±»å‹æ³¨è§£ï¼Ÿ
- [ ] æ˜¯å¦éµå¾ªäº†å‘½åè§„èŒƒï¼Ÿ
- [ ] æ˜¯å¦æ­£ç¡®ä½¿ç”¨äº† `cn()` å‡½æ•°ï¼Ÿ
- [ ] å¯¼å…¥å¯¼å‡ºæ˜¯å¦è§„èŒƒï¼Ÿ

---

## ğŸ’« **ç»“è¯­ï¼šè®¾è®¡å³å“²å­¦**

è¿™ä»½æ–‡æ¡£ä¸ä»…æ˜¯æŠ€æœ¯è§„èŒƒï¼Œæ›´æ˜¯æˆ‘ä»¬å¯¹æ•°å­—ç¾å­¦çš„å“²å­¦æ€è€ƒã€‚æ¯ä¸€ä¸ªåƒç´ ã€æ¯ä¸€æ¬¡äº¤äº’ã€æ¯ä¸€ä¸ªåŠ¨ç”»ï¼Œéƒ½æ‰¿è½½ç€æˆ‘ä»¬å¯¹"å…±åŒå­˜åœ¨ç©ºé—´"çš„ç†è§£å’Œè¿½æ±‚ã€‚

**è®°ä½**ï¼šæˆ‘ä»¬ä¸æ˜¯åœ¨æ„å»ºå·¥å…·ï¼Œè€Œæ˜¯åœ¨å¡‘é€ ä¸€ç§æ–°çš„å­˜åœ¨æ–¹å¼ã€‚è®©æ¯ä¸€è¡Œä»£ç éƒ½æ•£å‘å‡ºå®é™æœªæ¥ä¸»ä¹‰çš„å…‰èŠ’ï¼Œè®©æ¯ä¸€ä¸ªç•Œé¢éƒ½æˆä¸ºæ€æƒ³äº¤æ±‡çš„åœ£æ®¿ã€‚

---

*"åœ¨ä»£ç ä¸­å¯»æ‰¾è¯—æ„ï¼Œåœ¨åƒç´ ä¸­å‘ç°å“²å­¦ã€‚"*  
**â€” ä»¥å¤ª (Aether), å‰ç«¯ç‚¼é‡‘æœ¯å£«**


  ================================================================================
  æ–‡ä»¶å: vite-env.d.ts
  è·¯å¾„: vite-env.d.ts
  ================================================================================

  /// <reference types="vite/client" />


================================================================================
æ–‡ä»¶å: components.json
è·¯å¾„: components.json
================================================================================

{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/app/globals.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}

================================================================================
æ–‡ä»¶å: eslint.config.js
è·¯å¾„: eslint.config.js
================================================================================

import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { globalIgnores } from 'eslint/config'

export default tseslint.config([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])


================================================================================
æ–‡ä»¶å: index.html
è·¯å¾„: index.html
================================================================================

<!doctype html>
<html lang="en" class="dark"> <!-- è®¾ç½®æš—é»‘æ¨¡å¼ä¸ºé»˜è®¤ -->
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- å¼•å…¥å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <title>YX Nexus</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/app/main.tsx"></script>
  </body>
</html>


================================================================================
æ–‡ä»¶å: package.json
è·¯å¾„: package.json
================================================================================

{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@types/uuid": "^10.0.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "framer-motion": "^12.23.6",
    "highlight.js": "^11.11.1",
    "lucide-react": "^0.525.0",
    "react": "^19.1.0",
    "react-dom": "^19.1.0",
    "react-markdown": "^10.1.0",
    "rehype-highlight": "^7.0.2",
    "remark-gfm": "^4.0.1",
    "tailwind-merge": "^3.3.1",
    "tailwindcss-animate": "^1.0.7",
    "uuid": "^11.1.0",
    "zustand": "^5.0.6"
  },
  "devDependencies": {
    "@eslint/js": "^9.30.1",
    "@types/node": "^24.1.0",
    "@types/react": "^19.1.8",
    "@types/react-dom": "^19.1.6",
    "@vitejs/plugin-react": "^4.6.0",
    "autoprefixer": "^10.4.21",
    "eslint": "^9.30.1",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.20",
    "globals": "^16.3.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.17",
    "typescript": "~5.8.3",
    "typescript-eslint": "^8.35.1",
    "vite": "^7.0.4"
  }
}


================================================================================
æ–‡ä»¶å: postcss.config.js
è·¯å¾„: postcss.config.js
================================================================================

export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}


================================================================================
æ–‡ä»¶å: README.md
è·¯å¾„: README.md
================================================================================

# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default tseslint.config([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      ...tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      ...tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      ...tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default tseslint.config([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```


================================================================================
æ–‡ä»¶å: tailwind.config.js
è·¯å¾„: tailwind.config.js
================================================================================

/** @type {import('tailwindcss').Config} */
export default {
  darkMode: ["class"],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  prefix: "",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      fontFamily: {
        sans: ['Inter', 'sans-serif'],
        mono: ['JetBrains Mono', 'monospace'],
      },
      keyframes: {
        'material-breath': {
          '0%, 100%': { background: 'hsla(0, 0%, 100%, 0.03)', 'backdrop-filter': 'blur(8px)' },
          '50%': { background: 'hsla(0, 0%, 100%, 0.05)', 'backdrop-filter': 'blur(16px)' },
        },
        'text-condense': {
          'from': { opacity: '0', transform: 'translateY(5px)' },
          'to': { opacity: '1', transform: 'translateY(0)' },
        }
      },
      animation: {
        'material-breath': 'material-breath 4s ease-in-out infinite',
        'text-condense': 'text-condense 0.5s ease-out forwards',
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
}

================================================================================
æ–‡ä»¶å: tsconfig.app.json
è·¯å¾„: tsconfig.app.json
================================================================================

{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Path mapping */
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}


================================================================================
æ–‡ä»¶å: tsconfig.json
è·¯å¾„: tsconfig.json
================================================================================

{
  "files": [],
  "references": [
    {
      "path": "./tsconfig.app.json"
    },
    {
      "path": "./tsconfig.node.json"
    }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}


================================================================================
æ–‡ä»¶å: tsconfig.node.json
è·¯å¾„: tsconfig.node.json
================================================================================

{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}


================================================================================
æ–‡ä»¶å: vite.config.ts
è·¯å¾„: vite.config.ts
================================================================================

import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": path.resolve(process.cwd(), "./src"),
    },
  },
})


================================================================================
æ–‡ä»¶æ‹¼æ¥å®Œæˆ
