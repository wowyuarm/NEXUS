# render.yaml
# Blueprint for deploying the NEXUS project on Render.com
# This configuration defines two services: NEXUS backend and AURA frontend

services:
  #--------------------------------
  # NEXUS Backend Service
  #--------------------------------
  - name: nexus-backend
    type: web
    env: docker
    repo: https://github.com/wowyuarm/NEXUS
    dockerfilePath: ./nexus/Dockerfile
    plan: free
    region: oregon  # Choose your preferred region
      
    # Environment variables
    envVars:
      # Python configuration
      - key: PYTHON_VERSION
        value: "3.11"
      - key: PYTHONPATH
        value: "/app"
      - key: PYTHONUNBUFFERED
        value: "1"
        
      # LLM Provider Keys - Set these in Render Dashboard > Environment > Secrets
      # sync: false means these are secrets that need to be set in the dashboard
      - key: GEMINI_API_KEY
        sync: false
      - key: OPENROUTER_API_KEY
        sync: false
      - key: DEEPSEEK_API_KEY
        sync: false
        
      # Database configuration
      - key: MONGO_URI
        sync: false
        
      # Search provider configuration
      - key: TAVILY_API_KEY
        sync: false
        
      # Service configuration
      - key: NEXUS_ENV
        value: "production"
      - key: LOG_LEVEL
        value: "INFO"
        
  #--------------------------------
  # AURA Frontend Service
  #--------------------------------
  - name: aura-frontend
    type: web
    env: docker
    repo: https://github.com/wowyuarm/NEXUS
    dockerfilePath: ./Dockerfile
    rootDir: aura
    plan: free
    region: oregon  # Should match backend region
      
    # Environment variables
    envVars:
      # Build configuration (optional overrides - frontend also supports relative paths)
      - key: VITE_AURA_ENV
        value: "production"
      - key: VITE_AURA_WS_URL
        value: ""
      - key: VITE_AURA_API_URL
        value: ""
      - key: VITE_APP_NAME
        value: "AURA"
      # Runtime backend origin for nginx reverse proxy
      - key: BACKEND_ORIGIN
        value: "https://nexus-backend-tp8m.onrender.com"
    
    # Reverse proxy configuration removed; handled by nginx in container
        
#--------------------------------
# Render-specific Configuration
#--------------------------------

# Render will automatically set:
# - ${nexus-backend.url} - Internal URL for backend service
# - ${aura-frontend.url} - Internal URL for frontend service

# For production deployment, you need to:
# 1. Set these environment variables in Render Dashboard > Environment > Secrets:
#    - GEMINI_API_KEY
#    - OPENROUTER_API_KEY  
#    - DEEPSEEK_API_KEY
#    - MONGO_URI
#    - TAVILY_API_KEY
#
# 2. Run the configuration seeding script after deployment:
#    python scripts/seed_config.py --env production
#
# 3. Ensure MongoDB Atlas allows connections from Render's IP ranges
#
# Note: The frontend now uses environment-aware WebSocket URLs and reverse proxy,
# so no manual URL configuration is needed.
