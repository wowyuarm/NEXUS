# render.yaml
# Blueprint for deploying the NEXUS project on Render.com
# This configuration defines two services: NEXUS backend and AURA frontend

services:
  #--------------------------------
  # NEXUS Backend Service
  #--------------------------------
  - name: nexus-backend
    type: web
    env: docker
    repo: https://github.com/wowyuarm/NEXUS
    dockerfilePath: ./nexus/Dockerfile
    plan: free
    region: oregon  # Choose your preferred region
      
    # Environment variables
    envVars:
      # Python configuration
      - key: PYTHON_VERSION
        value: "3.11"
      - key: PYTHONPATH
        value: "/app"
      - key: PYTHONUNBUFFERED
        value: "1"
        
      # LLM Provider Keys - Set these in Render Dashboard > Environment > Secrets
      # sync: false means these are secrets that need to be set in the dashboard
      - key: GEMINI_API_KEY
        sync: false
      - key: OPENROUTER_API_KEY
        sync: false
      - key: DEEPSEEK_API_KEY
        sync: false
        
      # Database configuration
      - key: MONGO_URI
        sync: false
        
      # Search provider configuration
      - key: TAVILY_API_KEY
        sync: false
        
      # Service configuration
      - key: NEXUS_ENV
        value: "production"
      - key: LOG_LEVEL
        value: "INFO"
        
  #--------------------------------
  # AURA Frontend Service
  #--------------------------------
  - name: aura-frontend
    type: web
    env: docker
    repo: https://github.com/wowyuarm/NEXUS
    dockerfilePath: ./aura/Dockerfile
    plan: free
    region: oregon  # Should match backend region
      
    # Environment variables
    envVars:
      # WebSocket URL configuration
      # IMPORTANT: After deploying nexus-backend, replace this value with:
      # wss://nexus-backend-xxx.onrender.com/api/v1/ws
      - key: VITE_WS_URL
        value: "wss://your-backend-url.onrender.com/api/v1/ws"
        
      # Build configuration
      - key: NODE_ENV
        value: "production"
      - key: VITE_APP_NAME
        value: "NEXUS AURA"
        
#--------------------------------
# Render-specific Configuration
#--------------------------------

# Render will automatically set:
# - ${nexus-backend.url} - Internal URL for backend service
# - ${aura-frontend.url} - Internal URL for frontend service

# For production deployment, you need to:
# 1. Set these environment variables in Render Dashboard > Environment > Secrets:
#    - GEMINI_API_KEY
#    - OPENROUTER_API_KEY  
#    - DEEPSEEK_API_KEY
#    - MONGO_URI
#    - TAVILY_API_KEY
#
# 2. After first deployment of nexus-backend, copy its public URL and
#    update VITE_WS_URL in aura-frontend environment variables
#
# 3. Ensure MongoDB Atlas allows connections from Render's IP ranges
