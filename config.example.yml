# ===================================================================
# NEXUS 配置模板 (Configuration Template) v1.0
# 存在于'configurations'集合中的唯一文档
# ===================================================================

# -------------------------------------------------------------------
# A. 系统核心法则 (Core System Laws)
#    - 由系统管理员定义，不可被用户覆写。
#    - 控制系统的基本行为和安全边界。
# -------------------------------------------------------------------
system:
  log_level: "INFO"
  max_tool_iterations: 5
  # 工具执行超时时间（秒）
  tool_execution_timeout: 20
  # 定义应用名称，可下发给前端用于显示，（可选）也可作用户自定义
  app_name: "NEXUS"

# -------------------------------------------------------------------
# Server Configuration (服务器配置)
#    - 控制服务器监听的地址和端口
#    - 生产环境会优先使用环境变量 HOST 和 PORT
# -------------------------------------------------------------------
server:
  host: "0.0.0.0"  # 开发环境监听所有接口；生产环境由 HOST 环境变量覆盖
  port: 8000       # 开发环境端口；生产环境由 PORT 环境变量覆盖

security:
  # 明确声明哪些指令需要签名，前端可动态获取此列表
  signature_required_commands:
    - "identity"
    - "config"
    - "prompt"

# -------------------------------------------------------------------
# B. LLM 引擎目录 (LLM Engine Directory)
#    - 定义了系统可用的所有AI模型及其访问方式。
#    - Provider部分定义如何连接，Catalog部分定义有哪些模型。
# -------------------------------------------------------------------
llm:
  # 服务商连接信息 (不可被 user_config 覆写)
  providers:
    google:
      api_key: "${GEMINI_API_KEY}"
      base_url: "https://generativelanguage.googleapis.com/v1beta"
    deepseek:
      api_key: "${DEEPSEEK_API_KEY}"
      base_url: "https://api.deepseek.com/v1"
    openrouter:
      api_key: "${OPENROUTER_API_KEY}"
      base_url: "https://openrouter.ai/api/v1"

  # 模型名录 (不可被 user_config 覆写) - “模型即服务商”的核心实现
  catalog:
    gemini-3-flash:
      provider: google
      # provider具体模型ID（与key相同则可省略），id 是 provider 的模型ID
      id: gemini-3-flash-preview
      # 友好别名（供UI/用户选择），aliases 是模型的别名，用于在 UI 中显示
      aliases: ["Gemini-3-Flash"]
      default_params:
        temperature: 0.7
        max_tokens: 8192

    deepseek-chat:
      provider: deepseek
      id: deepseek-chat
      aliases: ["DeepSeek-Chat"]
      default_params:
        temperature: 0.9
        max_tokens: 8192

    moonshotai/kimi-k2:free: # OpenRouter一个模型的命名示例
      provider: openrouter
      id: moonshotai/kimi-k2:free
      aliases: ["Kimi-K2"]
      default_params:
        temperature: 0.8
        max_tokens: 8192
# -------------------------------------------------------------------
# C. 默认用户画像 (Default User Profile)
#    - 这是所有新成员创建时，所继承的默认配置。
#    - 也是所有成员在未进行个性化配置时的默认行为。
# -------------------------------------------------------------------
user_defaults:
  # 默认的、可被 user_config 覆写的运行时配置
  config:
    model: "gemini-3-flash" # 用户的默认模型选择
    temperature: 0.8          # 用户可以覆写 catalog 中的默认值
    max_tokens: 4096
    history_context_size: 20
  
  # 用户档案 - 用于 [FRIENDS_INFO] 上下文块
  # - CORE_IDENTITY: 在代码中定义 (nexus/services/context/prompts.py)
  # - [CAPABILITIES]: 从工具注册表动态生成
  # - [SHARED_MEMORY]: 从数据库历史获取
  # - [FRIENDS_INFO]: 从此处 + identities表获取
  # - [THIS_MOMENT]: 动态构建
  prompts:
    # 用户档案与偏好（用户可编辑）
    friends_profile:
      content: ""
      editable: true
      description: "About this friend - preferences, patterns, and context that AI should know"

# -------------------------------------------------------------------
# D. UI 渲染元数据 (UI Rendering Metadata)
#    - 后端下发给前端的“渲染指南”，实现前后端解耦。
# -------------------------------------------------------------------
ui:
  # 告诉/config面板哪些字段是允许用户编辑的
  editable_fields:
    - "config.model"
    - "config.temperature"
    - "config.max_tokens"
    - "config.history_context_size"
    - "prompts.friends_profile" # 允许编辑用户档案（关于这位朋友的信息）

  # 告诉/config面板每个字段的类型和可选值
  field_options:
    "config.model":
      type: "select"
      # 这个列表可以由后端在启动时动态地从llm.catalog的key中生成, 注意，这里的选项需要是aliases的值
      options: ["Gemini-3-Flash", "DeepSeek-Chat", "Kimi-K2"]
    # 在config面板中，可将以下作为进阶配置而不是默认显示，提升体验
    "config.temperature":
      type: "slider"
      min: 0.0
      max: 2.0
      step: 0.1
    "config.max_tokens":
      type: "slider"
      min: 1024
      max: 8192
      step: 1024
    "config.history_context_size":
      type: "slider"
      min: 10
      max: 50
      step: 10